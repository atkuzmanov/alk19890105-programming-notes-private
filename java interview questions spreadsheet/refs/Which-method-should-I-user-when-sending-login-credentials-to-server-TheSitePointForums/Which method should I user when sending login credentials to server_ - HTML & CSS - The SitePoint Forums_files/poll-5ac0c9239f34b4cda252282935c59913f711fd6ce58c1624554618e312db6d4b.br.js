define("discourse/plugins/poll/lib/even-round",["exports"],function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){for(var e=t.map(function(t){return t%1}),l=Math.ceil(e.reduce(function(t,e){return t+e})),o=0,s=e.length;o<l&&o<s;o++){for(var i=0,n=0,r=0;r<e.length;r++)e[r]>i&&(i=e[n=r]);if(++t[n],e[n]=0,100===t.map(function(t){return Math.floor(t)}).reduce(function(t,e){return t+e}))break}return t.map(function(t){return Math.floor(t)})}}),define("discourse/plugins/poll/lib/chart-colors",["exports"],function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getColors=function(t,e){var l=void 0;switch(e=e||"cool"){case"cool":l={0:[255,255,255],25:[220,237,200],50:[66,179,213],75:[26,39,62],100:[0,0,0]};break;case"warm":l={0:[255,255,255],25:[254,235,101],50:[228,82,27],75:[77,52,47],100:[0,0,0]}}for(var o=Object.keys(l),s=[],i=void 0,n=void 0,r=0;r<t;r++){i=(r+1)*(100/(t+1));for(var a=void 0,u=n=n||0;u<o.length;u++){if(!o[u+1]){a=u-1;break}if(i>=o[u]&&i<o[u+1]){a=u;break}}for(var p=(i-o[a])/(o[a+1]-o[a]),c=[],d=0;d<3;d++)c.push(Math.round(l[o[a]][d]-(l[o[a]][d]-l[o[a+1]][d])*p));s.push("rgb("+c.toString()+")"),n=a}return s}}),define("discourse/plugins/poll/lib/discourse-markdown/poll",["exports"],function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=function(t){t.whiteList(["div.poll","div.poll-info","div.poll-container","div.poll-buttons","div[data-*]","span.info-number","span.info-text","span.info-label","a.button.cast-votes","a.button.toggle-results","li[data-*]"]),function(t){t.registerOptions(function(t,e){t.features.poll=!!e.poll_enabled,t.pollMaximumOptions=e.poll_maximum_options}),t.registerPlugin(function(t){t.block.bbcode.ruler.push("poll",e)})}(t)};var m="data-poll-",v=["close","max","min","name","order","public","results","chartType","status","step","type"];function g(t,e,l){var o=t.indexOf(e),s=t[o].level;for(t.splice.apply(t,[o,1].concat(function(t){if(Array.isArray(t)){for(var e=0,l=Array(t.length);e<t.length;e++)l[e]=t[e];return l}return Array.from(t)}(l))),l[0].map=e.map;o<t.length;o++){var i=t[o].nesting;i<0&&s--,t[o].level=s,0<i&&s++}}function b(t,e){t.push("text","",0).content="[/"+e+"]"}var e={tag:"poll",before:function(t,e,l){var o=t.push("text","",0);o.content=l,o.bbcode_attrs=e.attrs,o.bbcode_type="poll_open"},after:function(t,e,l){var o=function(t,e){for(var l=t.length-1,o=[],s=[];t[l]!==e;l--){if(0===l)return;var i=t[l];if(0===i.level&&"ol"!==i.tag&&"ul"!==i.tag)return;if(1===i.level&&1===i.nesting){if("li"!==i.tag)return;o.push([i,s.reverse().join(" ")])}1===i.level&&1===i.nesting&&"li"===i.tag?s=[]:"text"!==i.type&&"inline"!==i.type||s.push(i.content)}return o.reverse()}(t.tokens,e);if(!o)return b(t,l);var s=e.bbcode_attrs,i=[["class","poll"]];s.status||i.push([m+"status","open"]),v.forEach(function(t){s[t]&&i.push([m+t,s[t]])}),s.name||i.push([m+"name","poll"]);var n=parseInt(s.min,10),r=parseInt(s.max,10),a=parseInt(s.step,10);a<1&&(a=1);var u=[],p=new t.Token("poll_open","div",1);if(p.block=!0,p.attrs=i,u.push(p),(p=new t.Token("poll_open","div",1)).block=!0,u.push(p),(p=new t.Token("poll_open","div",1)).attrs=[["class","poll-container"]],u.push(p),"number"===s.type){if(isNaN(n)&&(n=1),isNaN(r)&&(r=t.md.options.discourse.pollMaximumOptions),isNaN(a)&&(a=1),0<o.length)return b(t,l);p=new t.Token("bullet_list_open","ul",1),u.push(p);for(var c=n;c<=r;c+=a)p=new t.Token("list_item_open","li",1),o.push([p,String(c)]),u.push(p),(p=new t.Token("text","",0)).content=String(c),u.push(p),p=new t.Token("list_item_close","li",-1),u.push(p);p=new t.Token("bullet_item_close","",-1),u.push(p)}for(var d=0;d<o.length;d++){p=o[d][0];var h=o[d][1];p.attrs=p.attrs||[];var f=function(t){for(var e=0;e<t.length;e++)t[e]=x(t[e]);return t.join("")}(function(t){/[\x80-\xFF]/.test(t)&&(t=unescape(encodeURI(t)));var e,l=t.length,o=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)_(o,y(t.substring(e-64,e)));t=t.substring(e-64);var s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)s[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(s[e>>2]|=128<<(e%4<<3),55<e)for(_(o,s),e=0;e<16;e++)s[e]=0;return s[14]=8*l,_(o,s),o}(JSON.stringify([h])));p.attrs.push([m+"option-id",f])}g(t.tokens,e,u),t.level=t.tokens[t.tokens.length-1].level,t.push("poll_close","div",-1),(p=t.push("poll_open","div",1)).attrs=[["class","poll-info"]],t.push("paragraph_open","p",1),(p=t.push("span_open","span",1)).block=!1,p.attrs=[["class","info-number"]],(p=t.push("text","",0)).content="0",t.push("span_close","span",-1),(p=t.push("span_open","span",1)).block=!1,p.attrs=[["class","info-label"]],(p=t.push("text","",0)).content=I18n.t("poll.voters",{count:0}),t.push("span_close","span",-1),t.push("paragraph_close","p",-1),t.push("poll_close","div",-1),t.push("poll_close","div",-1),t.push("poll_close","div",-1)}};function _(t,e){var l=t[0],o=t[1],s=t[2],i=t[3];o=p(o=p(o=p(o=p(o=u(o=u(o=u(o=u(o=a(o=a(o=a(o=a(o=n(o=n(o=n(o=n(o,s=n(s,i=n(i,l=n(l,o,s,i,e[0],7,-680876936),o,s,e[1],12,-389564586),l,o,e[2],17,606105819),i,l,e[3],22,-1044525330),s=n(s,i=n(i,l=n(l,o,s,i,e[4],7,-176418897),o,s,e[5],12,1200080426),l,o,e[6],17,-1473231341),i,l,e[7],22,-45705983),s=n(s,i=n(i,l=n(l,o,s,i,e[8],7,1770035416),o,s,e[9],12,-1958414417),l,o,e[10],17,-42063),i,l,e[11],22,-1990404162),s=n(s,i=n(i,l=n(l,o,s,i,e[12],7,1804603682),o,s,e[13],12,-40341101),l,o,e[14],17,-1502002290),i,l,e[15],22,1236535329),s=a(s,i=a(i,l=a(l,o,s,i,e[1],5,-165796510),o,s,e[6],9,-1069501632),l,o,e[11],14,643717713),i,l,e[0],20,-373897302),s=a(s,i=a(i,l=a(l,o,s,i,e[5],5,-701558691),o,s,e[10],9,38016083),l,o,e[15],14,-660478335),i,l,e[4],20,-405537848),s=a(s,i=a(i,l=a(l,o,s,i,e[9],5,568446438),o,s,e[14],9,-1019803690),l,o,e[3],14,-187363961),i,l,e[8],20,1163531501),s=a(s,i=a(i,l=a(l,o,s,i,e[13],5,-1444681467),o,s,e[2],9,-51403784),l,o,e[7],14,1735328473),i,l,e[12],20,-1926607734),s=u(s,i=u(i,l=u(l,o,s,i,e[5],4,-378558),o,s,e[8],11,-2022574463),l,o,e[11],16,1839030562),i,l,e[14],23,-35309556),s=u(s,i=u(i,l=u(l,o,s,i,e[1],4,-1530992060),o,s,e[4],11,1272893353),l,o,e[7],16,-155497632),i,l,e[10],23,-1094730640),s=u(s,i=u(i,l=u(l,o,s,i,e[13],4,681279174),o,s,e[0],11,-358537222),l,o,e[3],16,-722521979),i,l,e[6],23,76029189),s=u(s,i=u(i,l=u(l,o,s,i,e[9],4,-640364487),o,s,e[12],11,-421815835),l,o,e[15],16,530742520),i,l,e[2],23,-995338651),s=p(s,i=p(i,l=p(l,o,s,i,e[0],6,-198630844),o,s,e[7],10,1126891415),l,o,e[14],15,-1416354905),i,l,e[5],21,-57434055),s=p(s,i=p(i,l=p(l,o,s,i,e[12],6,1700485571),o,s,e[3],10,-1894986606),l,o,e[10],15,-1051523),i,l,e[1],21,-2054922799),s=p(s,i=p(i,l=p(l,o,s,i,e[8],6,1873313359),o,s,e[15],10,-30611744),l,o,e[6],15,-1560198380),i,l,e[13],21,1309151649),s=p(s,i=p(i,l=p(l,o,s,i,e[4],6,-145523070),o,s,e[11],10,-1120210379),l,o,e[2],15,718787259),i,l,e[9],21,-343485551),t[0]=c(l,t[0]),t[1]=c(o,t[1]),t[2]=c(s,t[2]),t[3]=c(i,t[3])}function r(t,e,l,o,s,i){return c((e=c(c(e,t),c(o,i)))<<s|e>>>32-s,l)}function n(t,e,l,o,s,i,n){return r(e&l|~e&o,t,e,s,i,n)}function a(t,e,l,o,s,i,n){return r(e&o|l&~o,t,e,s,i,n)}function u(t,e,l,o,s,i,n){return r(e^l^o,t,e,s,i,n)}function p(t,e,l,o,s,i,n){return r(l^(e|~o),t,e,s,i,n)}function y(t){var e,l=[];for(e=0;e<64;e+=4)l[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return l}var o="0123456789abcdef".split("");function x(t){for(var e="",l=0;l<4;l++)e+=o[t>>8*l+4&15]+o[t>>8*l&15];return e}function c(t,e){return t+e&4294967295}}),Ember.TEMPLATES["javascripts/modal/poll-ui-builder"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"d-modal-body",null,[["title","class"],["poll.ui_builder.title","poll-ui-builder"]],{"statements":[[0,"  "],[7,"form"],[11,"class","poll-ui-builder-form form-horizontal"],[9],[0,"\\n    "],[7,"div"],[11,"class","options"],[9],[0,"\\n      "],[7,"div"],[11,"class","input-group poll-select"],[9],[0,"\\n        "],[7,"label"],[11,"class","input-group-label"],[9],[1,[29,"i18n",["poll.ui_builder.poll_type.label"],null],false],[10],[0,"\\n        "],[1,[29,"combo-box",null,[["content","value","allowInitialValueMutation","valueAttribute"],[[25,["pollTypes"]],[25,["pollType"]],true,"value"]]],false],[0,"\\n      "],[10],[0,"\\n\\n      "],[7,"div"],[11,"class","input-group poll-select"],[9],[0,"\\n        "],[7,"label"],[11,"class","input-group-label"],[9],[1,[29,"i18n",["poll.ui_builder.poll_result.label"],null],false],[10],[0,"\\n        "],[1,[29,"combo-box",null,[["content","value","allowInitialValueMutation","valueAttribute"],[[25,["pollResults"]],[25,["pollResult"]],true,"value"]]],false],[0,"\\n      "],[10],[0,"\\n\\n"],[4,"unless",[[25,["isNumber"]]],null,{"statements":[[0,"        "],[7,"div"],[11,"class","input-group poll-select"],[9],[0,"\\n          "],[7,"label"],[11,"class","input-group-label"],[9],[1,[29,"i18n",["poll.ui_builder.poll_chart_type.label"],null],false],[10],[0,"\\n          "],[1,[29,"combo-box",null,[["content","value","valueAttribute"],[[25,["pollChartTypes"]],[25,["chartType"]],"value"]]],false],[0,"\\n        "],[10],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[4,"if",[[25,["showMinMax"]]],null,{"statements":[[0,"        "],[7,"div"],[11,"class","input-group poll-number"],[9],[0,"\\n          "],[7,"label"],[11,"class","input-group-label"],[9],[1,[29,"i18n",["poll.ui_builder.poll_config.min"],null],false],[10],[0,"\\n          "],[1,[29,"input",null,[["type","value","valueAttribute","class"],["number",[25,["pollMin"]],"value","poll-options-min"]]],false],[0,"\\n        "],[10],[0,"\\n        "],[1,[29,"input-tip",null,[["validation"],[[25,["minMaxValueValidation"]]]]],false],[0,"\\n\\n        "],[7,"div"],[11,"class","input-group poll-number"],[9],[0,"\\n          "],[7,"label"],[11,"class","input-group-label"],[9],[1,[29,"i18n",["poll.ui_builder.poll_config.max"],null],false],[10],[0,"\\n          "],[1,[29,"input",null,[["type","value","valueAttribute","class"],["number",[25,["pollMax"]],"value","poll-options-max"]]],false],[0,"\\n        "],[10],[0,"\\n\\n"],[4,"if",[[25,["isNumber"]]],null,{"statements":[[0,"          "],[7,"div"],[11,"class","input-group poll-number"],[9],[0,"\\n            "],[7,"label"],[11,"class","input-group-label"],[9],[1,[29,"i18n",["poll.ui_builder.poll_config.step"],null],false],[10],[0,"\\n            "],[1,[29,"input",null,[["type","value","valueAttribute","min","class"],["number",[25,["pollStep"]],"value","1","poll-options-step"]]],false],[0,"\\n          "],[10],[0,"\\n          "],[1,[29,"input-tip",null,[["validation"],[[25,["minStepValueValidation"]]]]],false],[0,"\\n"]],"parameters":[]},null]],"parameters":[]},null],[0,"\\n"],[4,"unless",[[25,["isNumber"]]],null,{"statements":[[0,"        "],[7,"div"],[11,"class","input-group poll-textarea"],[9],[0,"\\n          "],[7,"label"],[9],[1,[29,"i18n",["poll.ui_builder.poll_options.label"],null],false],[10],[0,"\\n          "],[1,[29,"textarea",null,[["value","autocomplete"],[[25,["pollOptions"]],"discourse"]]],false],[0,"\\n        "],[10],[0,"\\n        "],[1,[29,"input-tip",null,[["validation"],[[25,["minNumOfOptionsValidation"]]]]],false],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[4,"unless",[[25,["isPie"]]],null,{"statements":[[0,"        "],[7,"div"],[11,"class","input-group poll-checkbox"],[9],[0,"\\n          "],[7,"label"],[9],[0,"\\n            "],[1,[29,"input",null,[["type","checked"],["checkbox",[25,["publicPoll"]]]]],false],[0,"\\n            "],[1,[29,"i18n",["poll.ui_builder.poll_public.label"],null],false],[0,"\\n          "],[10],[0,"\\n        "],[10],[0,"\\n"]],"parameters":[]},null],[0,"\\n      "],[7,"div"],[11,"class","input-group poll-checkbox"],[9],[0,"\\n        "],[7,"label"],[9],[0,"\\n          "],[1,[29,"input",null,[["type","checked"],["checkbox",[25,["autoClose"]]]]],false],[0,"\\n          "],[1,[29,"i18n",["poll.ui_builder.automatic_close.label"],null],false],[0,"\\n        "],[10],[0,"\\n      "],[10],[0,"\\n\\n"],[4,"if",[[25,["autoClose"]]],null,{"statements":[[0,"        "],[7,"div"],[11,"class","input-group poll-date"],[9],[0,"\\n          "],[1,[29,"date-picker-future",null,[["value","containerId"],[[25,["date"]],"date-container"]]],false],[0,"\\n          "],[1,[29,"input",null,[["type","value"],["time",[25,["time"]]]]],false],[0,"\\n          "],[7,"div"],[11,"id","date-container"],[9],[10],[0,"\\n        "],[10],[0,"\\n"]],"parameters":[]},null],[0,"    "],[10],[0,"\\n\\n    "],[7,"div"],[11,"class","d-editor-preview"],[9],[0,"\\n      "],[1,[29,"cook-text",[[24,0,["pollOutput"]]],null],false],[0,"\\n    "],[10],[0,"\\n  "],[10],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[7,"div"],[11,"class","modal-footer"],[9],[0,"\\n  "],[1,[29,"d-button",null,[["action","icon","class","label","disabled"],[[29,"action",[[24,0,[]],"insertPoll"],null],"chart-bar","btn-primary","poll.ui_builder.insert",[25,["disableInsert"]]]]],false],[0,"\\n"],[10],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/modal/poll-ui-builder"}}),define("discourse/plugins/poll/widgets/discourse-poll",["exports","discourse/widgets/widget","virtual-dom","discourse-common/lib/icon-library","discourse/widgets/raw-html","discourse/lib/ajax","discourse/lib/ajax-error","discourse/plugins/poll/lib/even-round","discourse/widgets/post","discourse/lib/round","discourse/lib/formatter","discourse/lib/load-script","../lib/chart-colors","@ember/string","../controllers/poll-ui-builder"],function(t,e,c,s,b,n,r,d,o,a,y,i,u,p,h){"use strict";function f(t){var e=$("<span>"+t.html+"</span>");return e.find(".discourse-local-date").each(function(t,e){$(e).applyLocalDates()}),new b.default({html:"<span>"+e.html()+"</span>"})}function x(t){return new b.default({html:'<span class="info-text">'+t+"</span>"})}function m(t){return(0,n.ajax)("/polls/voters.json",{data:t}).catch(function(t){t?(0,r.popupAjaxError)(t):bootbox.alert(I18n.t("poll.error_while_fetching_voters"))})}function v(t){var e=document.querySelector("#poll-results-chart-"+t);e&&e.parentNode.removeChild(e)}function g(t,e,l){var o=2<arguments.length&&void 0!==l?l:{},s="aspectRatio"in o?o.aspectRatio:2,i=!("displayLegend"in o)||o.displayLegend;return{type:h.PIE_CHART_TYPE,data:{datasets:[{data:t,backgroundColor:(0,u.getColors)(t.length)}],labels:e},options:{responsive:!0,aspectRatio:s,animation:{duration:400},legend:{display:i}}}}Object.defineProperty(t,"__esModule",{value:!0}),(0,e.createWidget)("discourse-poll-option",{tagName:"li",buildAttributes:function(t){return{"data-poll-option-id":t.option.id}},html:function(t){var e=[],l=t.option,o=t.vote.includes(l.id);return t.isMultiple?e.push((0,s.iconNode)(o?"far-check-square":"far-square")):e.push((0,s.iconNode)(o?"circle":"far-circle")),e.push(" "),e.push(f(l)),e},click:function(t){0===$(t.target).closest("a").length&&this.sendWidgetAction("toggleOption",this.attrs.option)}}),(0,e.createWidget)("discourse-poll-load-more",{tagName:"div.poll-voters-toggle-expand",buildKey:function(t){return"load-more-"+t.optionId},defaultState:function(){return{loading:!1}},html:function(t,e){return e.loading?(0,c.h)("div.spinner.small"):(0,c.h)("a",(0,s.iconNode)("chevron-down"))},click:function(){var t=this.state;if(!t.loading)return t.loading=!0,this.sendWidgetAction("loadMore").finally(function(){return t.loading=!1})}}),(0,e.createWidget)("discourse-poll-voters",{tagName:"ul.poll-voters-list",buildKey:function(t){return"poll-voters-"+t.optionId},defaultState:function(){return{loaded:"new",voters:[],page:1}},fetchVoters:function(){var o=this,s=this.attrs,i=this.state;if("loading"!==i.loaded)return i.loaded="loading",m({post_id:s.postId,poll_name:s.pollName,option_id:s.optionId,page:i.page}).then(function(t){i.loaded="loaded",i.page+=1;var e="number"===s.pollType?t.voters:t.voters[s.optionId],l=new Set(i.voters.map(function(t){return t.username}));e.forEach(function(t){l.has(t.username)||(l.add(t.username),i.voters.push(t))}),o.scheduleRerender()})},loadMore:function(){return this.fetchVoters()},html:function(t,e){t.voters&&"new"===e.loaded&&(e.voters=t.voters);var l=e.voters.map(function(t){return(0,c.h)("li",[(0,o.avatarFor)("tiny",{username:t.username,template:t.avatar_template})," "])});return e.voters.length<t.totalVotes&&l.push(this.attach("discourse-poll-load-more",t)),(0,c.h)("div.poll-voters",l)}}),(0,e.createWidget)("discourse-poll-standard-results",{tagName:"ul.results",buildKey:function(t){return"poll-standard-results-"+t.id},defaultState:function(){return{loaded:!1}},fetchVoters:function(){var e=this,t=this.attrs,l=this.state;return m({post_id:t.post.id,poll_name:t.poll.get("name")}).then(function(t){l.voters=t.voters,e.scheduleRerender()})},html:function(i,n){var r=this,a=i.poll,t=a.get("options");if(t){var e=a.get("voters"),u=a.get("public"),l=_.clone(t).sort(function(t,e){return t.votes<e.votes?1:t.votes===e.votes?t.html<e.html?-1:1:-1});u&&!n.loaded&&(n.voters=a.get("preloaded_voters"),n.loaded=!0);var o=0===e?Array(l.length).fill(0):l.map(function(t){return 100*t.votes/e}),p=i.isMultiple?o.map(Math.floor):(0,d.default)(o);return l.map(function(t,e){var l=[],o=p[e].toString(),s=(i.vote||[]).includes(t.id);return l.push((0,c.h)("div.option",(0,c.h)("p",[(0,c.h)("span.percentage",o+"%"),f(t)]))),l.push((0,c.h)("div.bar-back",(0,c.h)("div.bar",{attributes:{style:"width:"+o+"%"}}))),u&&l.push(r.attach("discourse-poll-voters",{postId:i.post.id,optionId:t.id,pollName:a.get("name"),totalVotes:t.votes,voters:n.voters&&n.voters[t.id]||[]})),(0,c.h)("li",{className:s?"chosen":""},l)})}}}),(0,e.createWidget)("discourse-poll-number-results",{buildKey:function(t){return"poll-number-results-"+t.id},defaultState:function(){return{loaded:!1}},fetchVoters:function(){var e=this,t=this.attrs,l=this.state;return m({post_id:t.post.id,poll_name:t.poll.get("name")}).then(function(t){l.voters=t.voters,e.scheduleRerender()})},html:function(t,e){var l=t.poll,o=l.get("options").reduce(function(t,e){return t+parseInt(e.html,10)*parseInt(e.votes,10)},0),s=l.get("voters"),i=0===s?0:(0,a.default)(o/s,-2),n=I18n.t("poll.average_rating",{average:i}),r=[(0,c.h)("div.poll-results-number-rating",new b.default({html:"<span>"+n+"</span>"}))];return l.get("public")&&(e.loaded||(e.voters=l.get("preloaded_voters"),e.loaded=!0),r.push(this.attach("discourse-poll-voters",{totalVotes:l.get("voters"),voters:e.voters||[],postId:t.post.id,pollName:l.get("name"),pollType:l.get("type")}))),r}}),(0,e.createWidget)("discourse-poll-container",{tagName:"div.poll-container",html:function(e){var l=this,t=e.poll,o=t.get("options");if(e.showResults){var s="number"===t.get("type")?"number":"standard",i="number"==s||e.poll.chart_type!==h.PIE_CHART_TYPE?"discourse-poll-"+s+"-results":"discourse-poll-pie-chart";return this.attach(i,e)}if(o)return(0,c.h)("ul",o.map(function(t){return l.attach("discourse-poll-option",{option:t,isMultiple:e.isMultiple,vote:e.vote})}))}}),(0,e.createWidget)("discourse-poll-info",{tagName:"div.poll-info",multipleHelpText:function(t,e,l){if(0<e)if(t===e){if(1<t)return I18n.t("poll.multiple.help.x_options",{count:t})}else{if(1<t)return e<l?I18n.t("poll.multiple.help.between_min_and_max_options",{min:t,max:e}):I18n.t("poll.multiple.help.at_least_min_options",{count:t});if(e<=l)return I18n.t("poll.multiple.help.up_to_max_options",{count:e})}},html:function(t){var e=t.poll,l=e.get("voters"),o=[(0,c.h)("p",[(0,c.h)("span.info-number",l.toString()),(0,c.h)("span.info-label",I18n.t("poll.voters",{count:l}))])];if(t.isMultiple)if(t.showResults||t.isClosed){var s=e.get("options").reduce(function(t,e){return t+parseInt(e.votes,10)},0);o.push((0,c.h)("p",[(0,c.h)("span.info-number",s.toString()),(0,c.h)("span.info-label",I18n.t("poll.total_votes",{count:s}))]))}else{var i=this.multipleHelpText(t.min,t.max,e.get("options.length"));i&&o.push(x(i))}return t.isClosed||t.showResults||!e.public||"staff_only"===e.results||o.push(x(I18n.t("poll.public.title"))),o}}),(0,e.createWidget)("discourse-poll-grouped-pies",{tagName:"div.poll-grouped-pies",buildAttributes:function(t){return{id:"poll-results-grouped-pie-charts-"+t.id}},html:function(u){var t=Object.assign({},u.groupableUserFields),o="field-select-"+u.id;u.groupedBy=u.groupedBy||t[0];var e=[],l=this.attach("button",{className:"btn-default poll-group-by-toggle",label:"poll.ungroup-results.label",title:"poll.ungroup-results.title",icon:"far-eye-slash",action:"toggleGroupedPieCharts"}),s=(0,c.h)("select#"+o+".poll-group-by-selector",{value:u.groupBy},u.groupableUserFields.map(function(t){return(0,c.h)("option",{value:t},function(t){var e=t.split("_").filter(Boolean);return e[0]=(0,p.classify)(e[0]),e.join(" ")}(t))}));return e.push((0,c.h)("div.poll-grouped-pies-controls",[l,s])),(0,n.ajax)("/polls/grouped_poll_results.json",{data:{post_id:u.post.id,poll_name:u.poll.name,user_field_name:u.groupedBy}}).catch(function(t){t?(0,r.popupAjaxError)(t):bootbox.alert(I18n.t("poll.error_while_fetching_voters"))}).then(function(r){var t=document.getElementById(o);if(t){t.value=u.groupedBy;for(var a=document.getElementById("poll-results-grouped-pie-charts-"+u.id),e=function(t){var e=g(r.grouped_results[t].options.mapBy("votes"),r.grouped_results[t].options.mapBy("html"),{aspectRatio:1.2,displayLegend:!1}),l="pie-"+u.id+"-"+t,o=document.querySelector("#"+l);if(o)Chart.helpers.each(Chart.instances,function(t){t.chart.canvas.id===l&&o.$chartjs&&(t.destroy(),new Chart(o.getContext("2d"),e))});else{var s=document.createElement("div");s.classList.add("poll-grouped-pie-container");var i=document.createElement("label");i.classList.add("poll-pie-label"),i.textContent=r.grouped_results[t].group;var n=document.createElement("canvas");n.classList.add("poll-grouped-pie-"+u.id),n.id=l,s.appendChild(i),s.appendChild(n),a.appendChild(s),new Chart(n.getContext("2d"),e)}},l=0;l<r.grouped_results.length;l++)e(l)}}),e},click:function(t){var e=$(t.target).closest("select");e.length&&this.sendWidgetAction("refreshCharts",e[0].value)}}),(0,e.createWidget)("discourse-poll-pie-canvas",{tagName:"canvas.poll-results-canvas",init:function(l){(0,i.default)("/javascripts/Chart.min.js").then(function(){var t=g(l.poll.options.mapBy("votes"),l.poll.options.mapBy("html")),e=document.getElementById("poll-results-chart-"+l.id);new Chart(e.getContext("2d"),t)})},buildAttributes:function(t){return{id:"poll-results-chart-"+t.id}}}),(0,e.createWidget)("discourse-poll-pie-chart",{tagName:"div.poll-results-chart",html:function(t){var e=[];if(!t.showResults)return v(t.id),e;var l=void 0,o=void 0;return t.groupResults&&0<t.groupableUserFields.length?(o=this.attach("discourse-poll-grouped-pies",t),v(t.id)):(t.groupableUserFields.length&&(l=this.attach("button",{className:"btn-default poll-group-by-toggle",label:"poll.group-results.label",title:"poll.group-results.title",icon:"far-eye",action:"toggleGroupedPieCharts"})),o=this.attach("discourse-poll-pie-canvas",t)),e.push(l),e.push(o),e}}),(0,e.createWidget)("discourse-poll-buttons",{tagName:"div.poll-buttons",html:function(t){var e=[],l=t.poll,o=t.post,s=o.get("topic.archived"),i=t.isClosed,n="staff_only"===l.results,r=this.currentUser&&this.currentUser.staff,a=this.currentUser&&this.currentUser.admin,u=this.siteSettings.data_explorer_enabled,p=!n&&(i||s),c=this.siteSettings.poll_export_data_explorer_query_id;if(t.isMultiple&&!p){var d=!t.canCastVotes;e.push(this.attach("button",{className:"cast-votes "+(d?"btn-default":"btn-primary"),label:"poll.cast-votes.label",title:"poll.cast-votes.title",disabled:d,action:"castVotes"})),e.push(" ")}if(t.showResults||p?e.push(this.attach("button",{className:"btn-default toggle-results",label:"poll.hide-results.label",title:"poll.hide-results.title",icon:"far-eye-slash",disabled:p,action:"toggleResults"})):"on_vote"!==l.get("results")||t.hasVoted?"on_close"!==l.get("results")||i?"staff_only"!==l.results||r?e.push(this.attach("button",{className:"btn-default toggle-results",label:"poll.show-results.label",title:"poll.show-results.title",icon:"far-eye",disabled:0===l.get("voters"),action:"toggleResults"})):e.push(x(I18n.t("poll.results.staff.title"))):e.push(x(I18n.t("poll.results.closed.title"))):e.push(x(I18n.t("poll.results.vote.title"))),a&&u&&0<l.voters&&c&&e.push(this.attach("button",{className:"btn btn-default export-results",label:"poll.export-results.label",title:"poll.export-results.title",icon:"download",disabled:0===l.voters,action:"exportResults"})),l.get("close")){var h=moment.utc(l.get("close"));if(h.isValid()){var f=h.format("LLL"),m=void 0;if(t.isAutomaticallyClosed){var v=(0,y.relativeAge)(h.toDate(),{addAgo:!0});m=I18n.t("poll.automatic_close.age",{age:v})}else{var g=moment().to(h.local(),!0);m=I18n.t("poll.automatic_close.closes_in",{timeLeft:g})}e.push(new b.default({html:'<span class="info-text" title="'+f+'">'+m+"</span>"}))}}return!this.currentUser||this.currentUser.get("id")!==o.get("user_id")&&!r||s||(i?t.isAutomaticallyClosed||e.push(this.attach("button",{className:"btn-default toggle-status",label:"poll.open.label",title:"poll.open.title",icon:"unlock-alt",action:"toggleStatus"})):e.push(this.attach("button",{className:"toggle-status btn-danger",label:"poll.close.label",title:"poll.close.title",icon:"lock",action:"toggleStatus"}))),e}}),t.default=(0,e.createWidget)("discourse-poll",{tagName:"div",buildKey:function(t){return"poll-"+t.id},buildAttributes:function(t){var e="poll";return t.poll.chart_type===h.PIE_CHART_TYPE&&(e+=" pie"),{class:e,"data-poll-name":t.poll.get("name"),"data-poll-type":t.poll.get("type")}},defaultState:function(t){var e=t.post,l=t.poll,o="staff_only"===t.poll.results;return{loading:!1,showResults:e.get("topic.archived")&&!o||this.isClosed()&&!o||"on_close"!==l.results&&this.hasVoted()&&!o}},html:function(t,e){var l="staff_only"===t.poll.results,o=e.showResults||t.post.get("topic.archived")&&!l||this.isClosed()&&!l,s=jQuery.extend({},t,{canCastVotes:this.canCastVotes(),hasVoted:this.hasVoted(),isAutomaticallyClosed:this.isAutomaticallyClosed(),isClosed:this.isClosed(),isMultiple:this.isMultiple(),max:this.max(),min:this.min(),showResults:o});return(0,c.h)("div",[this.attach("discourse-poll-container",s),this.attach("discourse-poll-info",s),this.attach("discourse-poll-buttons",s)])},min:function(){var t=parseInt(this.attrs.poll.get("min"),10);return(isNaN(t)||t<0)&&(t=0),t},max:function(){var t=parseInt(this.attrs.poll.get("max"),10),e=this.attrs.poll.get("options.length");return(isNaN(t)||e<t)&&(t=e),t},isAutomaticallyClosed:function(){var t=this.attrs.poll;return t.get("close")&&moment.utc(t.get("close"))<=moment()},isClosed:function(){return"closed"===this.attrs.poll.get("status")||this.isAutomaticallyClosed()},isMultiple:function(){return"multiple"===this.attrs.poll.get("type")},hasVoted:function(){var t=this.attrs.vote;return t&&0<t.length},canCastVotes:function(){var t=this.state,e=this.attrs;if(this.isClosed()||t.showResults||t.loading)return!1;var l=e.vote.length;return this.isMultiple()?l>=this.min()&&l<=this.max():0<l},toggleStatus:function(){var l=this,o=this.state,t=this.attrs,s=t.post,i=t.poll;this.isAutomaticallyClosed()||bootbox.confirm(I18n.t(this.isClosed()?"poll.open.confirm":"poll.close.confirm"),I18n.t("no_value"),I18n.t("yes_value"),function(t){if(t){o.loading=!0;var e=l.isClosed()?"open":"closed";(0,n.ajax)("/polls/toggle_status",{type:"PUT",data:{post_id:s.get("id"),poll_name:i.get("name"),status:e}}).then(function(){i.set("status",e),"on_close"===i.get("results")&&(o.showResults="closed"==e),l.scheduleRerender()}).catch(function(t){t?(0,r.popupAjaxError)(t):bootbox.alert(I18n.t("poll.error_while_toggling_status"))}).finally(function(){o.loading=!1})}})},toggleResults:function(){this.state.showResults=!this.state.showResults},exportResults:function(){var o=this.attrs,t=this.siteSettings.poll_export_data_explorer_query_id;(0,n.ajax)("/admin/plugins/explorer/queries/"+t+"/run.csv",{type:"POST",data:{params:JSON.stringify({poll_name:o.poll.name,post_id:o.post.id.toString()}),explain:!1,limit:1e6,download:1}}).then(function(t){var e=document.createElement("a"),l=new Blob([t],{type:"text/csv;charset=utf-8;"});e.href=URL.createObjectURL(l),e.setAttribute("download","poll-export-"+o.poll.name+"-"+o.post.id+".csv"),e.click(),e.remove()}).catch(function(t){t?(0,r.popupAjaxError)(t):bootbox.alert(I18n.t("poll.error_while_exporting_results"))})},showLogin:function(){this.register.lookup("route:application").send("showLogin")},toggleOption:function(t){var e=this.attrs;if(!this.isClosed()){if(!this.currentUser)return this.showLogin();var l=e.vote,o=l.indexOf(t.id);return this.isMultiple()||(l.length=0),-1!==o?l.splice(o,1):l.push(t.id),this.isMultiple()?void 0:this.castVotes()}},castVotes:function(){var l=this;if(this.canCastVotes()){if(!this.currentUser)return this.showLogin();var o=this.attrs,s=this.state;return s.loading=!0,(0,n.ajax)("/polls/vote",{type:"PUT",data:{post_id:o.post.id,poll_name:o.poll.get("name"),options:o.vote}}).then(function(t){var e=t.poll;o.poll.setProperties(e),"on_close"!==o.poll.get("results")&&(s.showResults=!0),"staff_only"===o.poll.results&&(l.currentUser&&l.currentUser.get("staff")?s.showResults=!0:s.showResults=!1)}).catch(function(t){t?(0,r.popupAjaxError)(t):bootbox.alert(I18n.t("poll.error_while_casting_votes"))}).finally(function(){s.loading=!1})}},toggleGroupedPieCharts:function(){this.attrs.groupResults=!this.attrs.groupResults},refreshCharts:function(t){var e=document.getElementById("poll-results-grouped-pie-charts-"+this.attrs.id);Array.from(e.getElementsByClassName("poll-grouped-pie-container")).forEach(function(t){e.removeChild(t)}),this.attrs.groupedBy=t}})}),define("discourse/plugins/poll/controllers/poll-ui-builder",["exports","@ember/controller","discourse-common/utils/decorators","@ember/object"],function(t,e,l,o){"use strict";function s(l,o,t,e,s){var i={};return Object.keys(e).forEach(function(t){i[t]=e[t]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=t.slice().reverse().reduce(function(t,e){return e(l,o,t)||t},i),s&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(s):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(l,o,i),i=null),i}var i,n,r,a,u,p,c,d,h,f,m,v,g,b,y,x,O,w;Object.defineProperty(t,"__esModule",{value:!0}),t.PIE_CHART_TYPE=t.BAR_CHART_TYPE=void 0;var P=t.BAR_CHART_TYPE="bar",C=t.PIE_CHART_TYPE="pie";t.default=e.default.extend((i=(0,l.default)("regularPollType","numberPollType","multiplePollType"),n=(0,l.default)("chartType","pollType","numberPollType"),r=(0,l.default)("alwaysPollResult","votePollResult","closedPollResult","staffPollResult"),a=(0,l.default)("pollType","regularPollType"),u=(0,l.default)("pollType","pollOptionsCount","multiplePollType"),p=(0,l.default)("pollType","numberPollType"),c=(0,l.default)("isRegular"),d=(0,l.default)("pollOptions"),h=(0,l.observes)("isMultiple","isNumber","pollOptionsCount"),f=(0,l.default)("isRegular","isMultiple","isNumber","pollOptionsCount"),m=(0,l.default)("isRegular","isMultiple","isNumber","pollOptionsCount","pollMin","pollStep"),v=(0,l.default)("isNumber","pollMax"),g=(0,l.default)("isNumber","showMinMax","pollType","pollResult","publicPoll","pollOptions","pollMin","pollMax","pollStep","autoClose","chartType","date","time"),b=(0,l.default)("pollOptionsCount","isRegular","isMultiple","isNumber","pollMin","pollMax"),y=(0,l.default)("pollMin","pollMax"),x=(0,l.default)("pollStep"),O=(0,l.default)("disableInsert"),s(w={regularPollType:"regular",numberPollType:"number",multiplePollType:"multiple",alwaysPollResult:"always",votePollResult:"on_vote",closedPollResult:"on_close",staffPollResult:"staff_only",pollChartTypes:[{name:P.capitalize(),value:P},{name:C.capitalize(),value:C}],init:function(){this._super.apply(this,arguments),this._setupPoll()},pollTypes:function(t,e,l){return[{name:I18n.t("poll.ui_builder.poll_type.regular"),value:t},{name:I18n.t("poll.ui_builder.poll_type.number"),value:e},{name:I18n.t("poll.ui_builder.poll_type.multiple"),value:l}]},isPie:function(t,e,l){return e!==l&&t===C},pollResults:function(t,e,l,o){var s=[{name:I18n.t("poll.ui_builder.poll_result.always"),value:t},{name:I18n.t("poll.ui_builder.poll_result.vote"),value:e},{name:I18n.t("poll.ui_builder.poll_result.closed"),value:l}];return this.currentUser.staff&&s.push({name:I18n.t("poll.ui_builder.poll_result.staff"),value:o}),s},isRegular:function(t,e){return t===e},isMultiple:function(t,e,l){return t===l&&0<e},isNumber:function(t,e){return t===e},showMinMax:function(t){return!t},pollOptionsCount:function(t){if(0===t.length)return 0;var e=0;return t.split("\n").forEach(function(t){0!==t.length&&(e+=1)}),e},_setPollMax:function(){var t=this.isMultiple,e=this.isNumber;(t||e)&&(t?this.set("pollMax",this.pollOptionsCount):e&&this.set("pollMax",this.siteSettings.poll_maximum_options))},pollMinOptions:function(t,e,l,o){if(!t)return e?this._comboboxOptions(1,o+1):l?this._comboboxOptions(1,this.siteSettings.poll_maximum_options+1):void 0},pollMaxOptions:function(t,e,l,o,s,i){if(!t){var n=parseInt(s,10)||1;if(e)return this._comboboxOptions(n+1,o+1);if(l){var r=parseInt(i,10);return r<1&&(r=1),this._comboboxOptions(n+1,n+this.siteSettings.poll_maximum_options*r)}}},pollStepOptions:function(t,e){if(t)return this._comboboxOptions(1,(parseInt(e,10)||1)+1)},pollOutput:function(t,e,l,o,s,i,n,r,a,u,p,c,d){var h="[poll",f="",m=this.toolbarEvent.getText().match(/\[poll(\s+name=[^\s\]]+)*.*\]/gim);m&&(h+=" name=poll"+(m.length+1));var v=a;if(v<1&&(v=1),l&&(h+=" type="+l),o&&(h+=" results="+o),n&&e&&(h+=" min="+n),r&&(h+=" max="+r),t&&(h+=" step="+v),s&&(h+=" public=true"),p&&"number"!==l&&(h+=" chartType="+p),u){var g=moment(c+" "+d,"YYYY-MM-DD HH:mm").toISOString();g&&(h+=" close="+g)}return f+=(h+="]")+"\n",0<i.length&&!t&&i.split("\n").forEach(function(t){0!==t.length&&(f+="* "+t+"\n")}),f+="[/poll]\n"},disableInsert:function(t,e,l,o,s,i){return e&&t<2||l&&t<s&&i<=s||!o&&t<2},minMaxValueValidation:function(t,e){var l={ok:!0};return e<=t&&(l={failed:!0,reason:I18n.t("poll.ui_builder.help.invalid_values")}),o.default.create(l)},minStepValueValidation:function(t){var e={ok:!0};return t<1&&(e={failed:!0,reason:I18n.t("poll.ui_builder.help.min_step_value")}),o.default.create(e)},minNumOfOptionsValidation:function(t){var e={ok:!0};return t&&(e={failed:!0,reason:I18n.t("poll.ui_builder.help.options_count")}),o.default.create(e)},_comboboxOptions:function(t,e){return _.range(t,e).map(function(t){return{value:t,name:t}})},_setupPoll:function(){this.setProperties({pollType:null,publicPoll:!1,pollOptions:"",pollMin:1,pollMax:null,pollStep:1,autoClose:!1,chartType:P,date:moment().add(1,"day").format("YYYY-MM-DD"),time:moment().add(1,"hour").format("HH:mm")})},actions:{insertPoll:function(){this.toolbarEvent.addText(this.pollOutput),this.send("closeModal"),this._setupPoll()}}},"pollTypes",[i],Object.getOwnPropertyDescriptor(w,"pollTypes"),w),s(w,"isPie",[n],Object.getOwnPropertyDescriptor(w,"isPie"),w),s(w,"pollResults",[r],Object.getOwnPropertyDescriptor(w,"pollResults"),w),s(w,"isRegular",[a],Object.getOwnPropertyDescriptor(w,"isRegular"),w),s(w,"isMultiple",[u],Object.getOwnPropertyDescriptor(w,"isMultiple"),w),s(w,"isNumber",[p],Object.getOwnPropertyDescriptor(w,"isNumber"),w),s(w,"showMinMax",[c],Object.getOwnPropertyDescriptor(w,"showMinMax"),w),s(w,"pollOptionsCount",[d],Object.getOwnPropertyDescriptor(w,"pollOptionsCount"),w),s(w,"_setPollMax",[h],Object.getOwnPropertyDescriptor(w,"_setPollMax"),w),s(w,"pollMinOptions",[f],Object.getOwnPropertyDescriptor(w,"pollMinOptions"),w),s(w,"pollMaxOptions",[m],Object.getOwnPropertyDescriptor(w,"pollMaxOptions"),w),s(w,"pollStepOptions",[v],Object.getOwnPropertyDescriptor(w,"pollStepOptions"),w),s(w,"pollOutput",[g],Object.getOwnPropertyDescriptor(w,"pollOutput"),w),s(w,"disableInsert",[b],Object.getOwnPropertyDescriptor(w,"disableInsert"),w),s(w,"minMaxValueValidation",[y],Object.getOwnPropertyDescriptor(w,"minMaxValueValidation"),w),s(w,"minStepValueValidation",[x],Object.getOwnPropertyDescriptor(w,"minStepValueValidation"),w),s(w,"minNumOfOptionsValidation",[O],Object.getOwnPropertyDescriptor(w,"minNumOfOptionsValidation"),w),w))}),define("discourse/plugins/poll/initializers/add-poll-ui-builder",["exports","discourse/lib/plugin-api","discourse-common/utils/decorators","discourse/lib/show-modal"],function(t,e,l,o){"use strict";function s(t){var e;t.modifyClass("controller:composer",(function(l,o,t,e,s){var i={};Object.keys(e).forEach(function(t){i[t]=e[t]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=t.slice().reverse().reduce(function(t,e){return e(l,o,t)||t},i),s&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(s):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(l,o,i),i=null)}(e={canBuildPoll:function(t,e,l){return t&&(l||this.currentUser&&(this.currentUser.staff||this.currentUser.trust_level>=e))},actions:{showPollBuilder:function(){(0,o.default)("poll-ui-builder").set("toolbarEvent",this.toolbarEvent)}}},"canBuildPoll",[(0,l.default)("siteSettings.poll_enabled","siteSettings.poll_minimum_trust_level_to_create","model.topic.pm_with_non_human_user")],Object.getOwnPropertyDescriptor(e,"canBuildPoll"),e),e)),t.addToolbarPopupMenuOptionsCallback(function(){return{action:"showPollBuilder",icon:"chart-bar",label:"poll.ui_builder.title",condition:"canBuildPoll"}})}Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"add-poll-ui-builder",initialize:function(){(0,e.withPluginApi)("0.8.7",s)}}}),define("discourse/plugins/poll/initializers/extend-for-poll",["exports","discourse/lib/plugin-api","discourse-common/utils/decorators","discourse-common/lib/get-owner","discourse/widgets/glue"],function(t,e,l,i,v){"use strict";function o(h){var t,f=(0,i.getRegister)(h);h.modifyClass("controller:topic",{subscribe:function(){var l=this;this._super.apply(this,arguments),this.messageBus.subscribe("/polls/"+this.get("model.id"),function(t){var e=l.get("model.postStream").findLoadedPost(t.post_id);e&&e.set("polls",t.polls)})},unsubscribe:function(){this.messageBus.unsubscribe("/polls/*"),this._super.apply(this,arguments)}});var m=[],o=null;function s(){m.forEach(function(t){return t.queueRerender()})}h.modifyClass("model:post",(function(l,o,t,e,s){var i={};Object.keys(e).forEach(function(t){i[t]=e[t]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=t.slice().reverse().reduce(function(t,e){return e(l,o,t)||t},i),s&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(s):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(l,o,i),i=null)}(t={_polls:null,pollsObject:null,pollsChanged:function(){var e=this,t=this.polls;t&&(this._polls=this._polls||{},t.forEach(function(t){e._polls[t.name]?e._polls[t.name].setProperties(t):e._polls[t.name]=Ember.Object.create(t)}),this.set("pollsObject",this._polls),s())}},"pollsChanged",[(0,l.observes)("polls")],Object.getOwnPropertyDescriptor(t,"pollsChanged"),t),t)),h.includePostAttributes("polls","polls_votes"),h.decorateCooked(function(t,e){var l=$(".poll",t);if(l.length&&e){var p=e.getModel();h.preventCloak(p.id),p.pollsChanged();var c=p.pollsObject||{},d=p.polls_votes||{};o=o||setInterval(s,3e4),l.each(function(t,e){var l=$(e),o=l.data("poll-name"),s=c[o],i=d[o]||[],n=l.parent(".expanded-quote").data("post-id");if(n){var r=p.quoted[n];r&&(p=Ember.Object.create(r),s=Ember.Object.create(r.polls.find(function(t){return t.name===o})),i=(i=r.polls_votes||{})[o]||[])}if(s){var a={id:o+"-"+p.id,post:p,poll:s,vote:i,groupableUserFields:(h.container.lookup("site-settings:main").poll_groupable_user_fields||"").split("|").filter(Boolean)},u=new v.default("discourse-poll",f,a);u.appendTo(e),m.push(u)}})}},{onlyStream:!0,id:"discourse-poll"}),h.cleanupStream(function(){o&&(clearInterval(o),o=null),m.forEach(function(t){return t.cleanUp()}),m=[]})}Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"extend-for-poll",initialize:function(){(0,e.withPluginApi)("0.8.7",o)}}});
//# sourceMappingURL=https://sjc5.discourse-cdn.com/sitepoint/community/assets/plugins/poll-5ac0c9239f34b4cda252282935c59913f711fd6ce58c1624554618e312db6d4b.js.map