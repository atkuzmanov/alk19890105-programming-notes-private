window.esw.defineFeature("Broadcast",function(c){function b(){this.esw=c;this.callbacks={};this.storage=window.localStorage;this.prefix="__broadcastAPI:";this.queue={};this.on();this.off();this.send();window.addEventListener("storage",function(h){var j=h.newValue;var i="";var g;if(h.key.indexOf(this.prefix)===0&&h.oldValue===null){g=h.key.replace(this.prefix,"");if(j!=="undefined"){i=JSON.parse(j);}this.broadcast(g,i);}}.bind(this));window.addEventListener("storage",function(h){var g;if(h.key.indexOf(this.prefix)===0&&h.newValue===null){g=h.key.replace(this.prefix,"");if(g in this.queue){this.send(g,this.queue[g].shift());if(this.queue[g].length===0){delete this.queue[g];}}}}.bind(this));}b.prototype.on=function a(g,h){if(!(g in this.callbacks)){this.callbacks[g]=[];}this.callbacks[g].push(h);};b.prototype.off=function f(h,i){var g;if(h in this.callbacks){if(typeof i==="function"){g=this.callbacks[h].indexOf(i);this.callbacks[h].splice(g,1);}if(typeof i!=="function"||this.callbacks[h].length===0){delete this.callbacks[h];}}};b.prototype.send=function e(g,i){var h=this.prefix+g;if(this.storage.getItem(h)===null){this.storage.setItem(h,JSON.stringify(i,function(l,j){if(j===undefined){return null;}else{return j;}}));this.storage.removeItem(h);}else{if(!(h in this.queue)){this.queue[h]=[];}this.queue[h].push(i);}};b.prototype.broadcast=function d(g,h){if(g in this.callbacks){this.callbacks[g].forEach(function(i){i(h);});}};c.broadcastAPI=new b();});