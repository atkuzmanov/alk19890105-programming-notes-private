embedded_svc.defineFeature("Invite",function(q){var n=false;var e={};var s={};var x={};var p=0;var c="embeddedServiceAvatar";var b="snapins_invite";var j=new function(){var F={PAGE_COUNT:"snapinsPc",SESSION_START:"snapinsStart",PAGE:"snapinsPage_",PAGE_TIME:"snapinsPageTime_"};this.init=function(){var G=parseInt(window.localStorage.getItem(F.PAGE_COUNT),10)||0;if(!window.localStorage.getItem(F.SESSION_START)){window.localStorage.setItem(F.SESSION_START,new Date().getTime().toString());}window.localStorage.setItem(F.PAGE_COUNT,(G+1).toString());window.localStorage.setItem(F.PAGE+G.toString(),window.location.href);window.localStorage.setItem(F.PAGE_TIME+G.toString(),new Date().getTime());};this.getPageCount=function(){return parseInt(window.localStorage.getItem(F.PAGE_COUNT),10);};this.getSessionStart=function(){return window.localStorage.getItem(F.SESSION_START);};this.getCurrentPage=function(){return window.localStorage.getItem(F.PAGE+(this.getPageCount()-1).toString());};}();function E(F){var G=["Webkit","Moz","O","ms","Khtml"];var H;if(F.style.animationName!==undefined){return"";}G.forEach(function(I){if(F.style[I+"AnimationName"]!==undefined){H=I.toLowerCase();}});return H;}function v(G,F,H){if(G.addEventListener){G.addEventListener(F,H,false);}else{if(G.attachEvent){G.attachEvent("on"+F,H,false);}else{throw new Error("Could not add event listener");}}}function g(){}g.TYPE={STANDARD:"STANDARD",INVITE:"INVITE",AGENT:"AGENT"};g.prototype.init=function(G,F){this.buttonId=G;this.type=F;this.onlineState=undefined;this.trackers=[];};g.prototype.getType=function(){return this.type;};g.prototype.getOnlineState=function(){return this.onlineState;};g.prototype.setOnlineState=function(F){this.onlineState=F;this.trackers.forEach(function(G){G.setState(F);});};function k(){}k.prototype.init=function(G,F){this.left=G;this.right=F;};k.prototype.evaluate=function(F){return false;};function u(){}u.TYPE={NUMBER_OF_PAGE_VIEWS:"NUMBER_OF_PAGE_VIEWS",URL_MATCH:"URL_MATCH",SECONDS_ON_PAGE:"SECONDS_ON_PAGE",SECONDS_ON_SITE:"SECONDS_ON_SITE",CUSTOM_VARIABLE:"CUSTOM_VARIABLE"};u.OPERATOR={EQUALS:"EQUALS",NOT_EQUAL:"NOT_EQUAL",START_WITH:"START_WITH",CONTAINS:"CONTAINS",NOT_CONTAIN:"NOT_CONTAIN",LESS_THAN:"LESS_THAN",GREATER_THAN:"GREATER_THAN",LESS_OR_EQUAL:"LESS_OR_EQUAL",GREATER_OR_EQUAL:"GREATER_OR_EQUAL"};u.prototype.init=function(J,I,F,G,H){this.ruleId=J;this.buttonId=I;this.compareFrom=F;this.operator=G;this.compareTo=H;};u.prototype.getId=function(){return this.ruleId;};u.prototype.evaluate=function(G,F){switch(this.operator){case u.OPERATOR.EQUALS:q.log("Evaluate: "+G+" == "+F);return G===F;case u.OPERATOR.NOT_EQUAL:q.log("Evaluate: "+G+" != "+F);return G!==F;case u.OPERATOR.START_WITH:q.log("Evaluate: "+G+" indexOf "+F+" == 0");return G.indexOf(F)===0;case u.OPERATOR.CONTAINS:q.log("Evaluate: "+G+" indexOf "+F+" != -1");return G.indexOf(F)!==-1;case u.OPERATOR.NOT_CONTAIN:q.log("Evaluate: "+G+" indexOf "+F+" == -1");return G.indexOf(F)===-1;case u.OPERATOR.LESS_THAN:q.log("Evaluate: "+parseFloat(G)+" < "+parseFloat(F));return parseFloat(G)<parseFloat(F);case u.OPERATOR.GREATER_THAN:q.log("Evaluate: "+parseFloat(G)+" > "+parseFloat(F));return parseFloat(G)>parseFloat(F);case u.OPERATOR.LESS_OR_EQUAL:q.log("Evaluate: "+parseFloat(G)+" <= "+parseFloat(F));return parseFloat(G)<=parseFloat(F);case u.OPERATOR.GREATER_OR_EQUAL:q.log("Evaluate: "+parseFloat(G)+" >= "+parseFloat(F));return parseFloat(G)>=parseFloat(F);default:return undefined;}};function d(F){this.ruleId=F;k.prototype.init.call(this,null,null);}d.prototype=new k();d.prototype.evaluate=function(F){q.log("Evaluating Atom Node: "+this.ruleId);return F.getRule(this.ruleId).evaluate();};function y(G,F){k.prototype.init.call(this,G,F);}y.prototype=new k();y.prototype.evaluate=function(F){var G;q.log("Evaluating And Node");G=this.left.evaluate(F)&&this.right.evaluate(F);return G;};function m(G,F){k.prototype.init.call(this,G,F);}m.prototype=new k();m.prototype.evaluate=function(F){var G=this.left.evaluate(F)||this.right.evaluate(F);q.log("Evaluating Or Node");return G;};function z(F){k.prototype.init.call(this,F,null);}z.prototype=new k();z.prototype.evaluate=function(F){var G=!this.left.evaluate(F);q.log("Evaluating Not Node");return G;};function C(F){if(i(F)){return i(F).getTracker();}return null;}function t(){}t.prototype.init=function(H,F,G,I){if(window.innerWidth){this.realWidth=window.innerWidth;}else{if(document.documentElement&&document.documentElement.clientWidth){this.realWidth=document.documentElement.clientWidth;}else{if(document.body){this.realWidth=document.body.clientWidth;}}}if(window.innerHeight){this.realHeight=window.innerHeight;}else{if(document.documentElement&&document.documentElement.clientHeight){this.realHeight=document.documentElement.clientHeight;}else{if(document.body){this.realHeight=document.body.clientHeight;}}}this.offset=25;this.buttonId=H;this.animationPrefix=E(F);this.element=F;this.element.style.position=this.animationPrefix?"fixed":"absolute";this.element.style.left="-1000px";this.element.style.top="-1000px";this.element.style.zIndex="10000";this.element.style.display="";this.element.style.visibility="visible";this.width=this.element.offsetWidth;this.height=this.element.offsetHeight;this.startPosition=G;this.endPosition=I;};t.prototype.render=function(){this.element.style.display="";};t.prototype.renderFinish=function(){};t.prototype.remove=function(F){this.element.style.left="-1000px";this.element.style.top="-1000px";};t.prototype.addRenderListeners=function(){var G=this.buttonId;var F="AnimationIteration";var H="AnimationEnd";if(this.animationPrefix===""){F=F.toLowerCase();H=H.toLowerCase();}else{F=this.animationPrefix+F;H=this.animationPrefix+H;}v(this.element,F,function(){C(G).renderFinish();});v(this.element,H,function(){C(G).removeFinish();});};function B(H,F,G,I){t.prototype.init.call(this,H,F,G,I);}B.prototype=new t();B.prototype.render=function(){var G=this.width*this.startPosition.xPosition+this.offset*this.startPosition.xOffset;var K=this.height*this.startPosition.yPosition+this.offset*this.startPosition.yOffset;var I=this.width*this.endPosition.xPercent*-1+this.offset*this.endPosition.xOffset;var H=this.height*this.endPosition.yPercent*-1+this.offset*this.endPosition.yOffset;var F=document.createElement("style");var J="";t.prototype.addRenderListeners.call(this);if(this.animationPrefix!==""){J="-"+this.animationPrefix+"-";}F.innerHTML="@"+J+"keyframes slide"+this.buttonId+"{"+"from { margin-left: "+G+"px; margin-top: "+K+"px; left: "+this.startPosition.xPercent*100+"%; top: "+this.startPosition.yPercent*100+"%; }"+"to { margin-left: "+I+"px; margin-top: "+H+"px; left: "+this.endPosition.xPercent*100+"%; top: "+this.endPosition.yPercent*100+"%; }"+"}";document.getElementsByTagName("head")[0].appendChild(F);this.element.style[J+"animation-name"]="slide"+this.buttonId;this.element.style[J+"animation-duration"]="1s";this.element.style[J+"animation-iteration-count"]="2";this.element.style[J+"animation-direction"]="alternate";this.element.style[J+"animation-timing-function"]="ease-in-out";this.element.style.setProperty(J+"animation-name","slide"+this.buttonId,"");this.element.style.setProperty(J+"animation-duration","1s","");this.element.style.setProperty(J+"animation-iteration-count","2","");this.element.style.setProperty(J+"animation-direction","alternate","");this.element.style.setProperty(J+"animation-timing-function","ease-in-out","");t.prototype.render.call(this);};B.prototype.renderFinish=function(){var F="";if(this.animationPrefix!==""){F="-"+this.animationPrefix+"-";}this.element.style[F+"animation-play-state"]="paused";this.element.style.setProperty(F+"animation-play-state","paused","");};B.prototype.remove=function(F){var G="";if(this.animationPrefix!==""){G="-"+this.animationPrefix+"-";}if(F){this.element.style[G+"animation-play-state"]="running";this.element.style.setProperty(G+"animation-play-state","running","");}else{this.element.style[G+"animation-name"]="";this.element.style.setProperty(G+"animation-name","","");t.prototype.remove.call(this,F);}};function a(H,F,G,I){t.prototype.init.call(this,H,F,null,I);}a.prototype=new t();a.prototype.render=function(){var F="";var I=document.createElement("style");var H=this.width*this.endPosition.xPercent*-1+this.offset*this.endPosition.xOffset;var G=this.height*this.endPosition.yPercent*-1+this.offset*this.endPosition.yOffset;t.prototype.addRenderListeners.call(this);if(this.animationPrefix!==""){F="-"+this.animationPrefix+"-";}I.innerHTML="@"+F+"keyframes fade"+this.buttonId+"{"+"from { opacity: 0; }"+"to { opacity: 1; }"+"}";document.getElementsByTagName("head")[0].appendChild(I);this.element.style[F+"animation-name"]="fade"+this.buttonId;this.element.style[F+"animation-duration"]="1s";this.element.style[F+"animation-iteration-count"]="2";this.element.style[F+"animation-direction"]="alternate";this.element.style[F+"animation-timing-function"]="ease-in-out";this.element.style.setProperty(F+"animation-name","fade"+this.buttonId,"");this.element.style.setProperty(F+"animation-duration","1s","");this.element.style.setProperty(F+"animation-iteration-count","2","");this.element.style.setProperty(F+"animation-direction","alternate","");this.element.style.setProperty(F+"animation-timing-function","ease-in-out","");this.element.style.marginLeft=H+"px";this.element.style.left=this.endPosition.xPercent*100+"%";this.element.style.marginTop=G+"px";this.element.style.top=this.endPosition.yPercent*100+"%";t.prototype.render.call(this);};a.prototype.renderFinish=function(){var F="";if(this.animationPrefix!==""){F="-"+this.animationPrefix+"-";}this.element.style[F+"animation-name"]="";this.element.style.setProperty(F+"animation-name","","");};a.prototype.remove=function(F){var G="";if(this.animationPrefix!==""){G="-"+this.animationPrefix+"-";}if(F){this.element.style[G+"animation-play-state"]="running";this.element.style.setProperty(G+"animation-play-state","running","");this.element.style.opacity=0;}else{this.element.style[G+"animation-name"]="";this.element.style.setProperty(G+"animation-name","","");t.prototype.remove.call(this,F);}};function l(H,F,G,I){t.prototype.init.call(this,H,F,null,I);}l.prototype=new t();l.prototype.render=function(){var G=this.width*this.endPosition.xPercent*-1+this.offset*this.endPosition.xOffset;var F=this.height*this.endPosition.yPercent*-1+this.offset*this.endPosition.yOffset;this.element.style.marginLeft=G+"px";this.element.style.left=this.endPosition.xPercent*100+"%";this.element.style.marginTop=F+"px";this.element.style.top=this.endPosition.yPercent*100+"%";t.prototype.render.call(this);C(this.buttonId).renderFinish();};l.prototype.remove=function(F){if(F){C(this.buttonId).removeFinish();}else{t.prototype.remove.call(this,F);}};function D(F){g.prototype.init.call(this,F,g.TYPE.INVITE);this.active=false;this.filterLogic=null;this.rules={};this.ruleTree=null;this.inviteDelay=null;this.inviteTimeout=null;this.autoRejectTimeout=null;}D.prototype=new g();D.RENDERER={Slide:{RenderClass:B},Fade:{RenderClass:a},Appear:{RenderClass:l}};D.START_POSITION={TopLeft:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:0,yPosition:-1,yOffset:-1},TopLeftTop:{xPercent:0,xPosition:0,xOffset:1,yPercent:0,yPosition:-1,yOffset:-1},Top:{xPercent:0.5,xPosition:-0.5,xOffset:0,yPercent:0,yPosition:-1,yOffset:-1},TopRightTop:{xPercent:1,xPosition:-1,xOffset:-1,yPercent:0,yPosition:-1,yOffset:-1},TopRight:{xPercent:1,xPosition:0,xOffset:1,yPercent:0,yPosition:-1,yOffset:-1},TopRightRight:{xPercent:1,xPosition:0,xOffset:1,yPercent:0,yPosition:0,yOffset:1},Right:{xPercent:1,xPosition:0,xOffset:1,yPercent:0.5,yPosition:-0.5,yOffset:0},BottomRightRight:{xPercent:1,xPosition:0,xOffset:1,yPercent:1,yPosition:-1,yOffset:-1},BottomRight:{xPercent:1,xPosition:0,xOffset:1,yPercent:1,yPosition:0,yOffset:1},BottomRightBottom:{xPercent:1,xPosition:-1,xOffset:-1,yPercent:1,yPosition:0,yOffset:1},Bottom:{xPercent:0.5,xPosition:-0.5,xOffset:0,yPercent:1,yPosition:0,yOffset:1},BottomLeftBottom:{xPercent:0,xPosition:0,xOffset:1,yPercent:1,yPosition:0,yOffset:1},BottomLeft:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:1,yPosition:0,yOffset:1},BottomLeftLeft:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:1,yPosition:-1,yOffset:-1},Left:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:0.5,yPosition:-0.5,yOffset:0},TopLeftLeft:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:0,yPosition:0,yOffset:1}};D.END_POSITION={TopLeft:{xPercent:0,xOffset:1,yPercent:0,yOffset:1},Top:{xPercent:0.5,xOffset:0,yPercent:0,yOffset:1},TopRight:{xPercent:1,xOffset:-1,yPercent:0,yOffset:1},Left:{xPercent:0,xOffset:1,yPercent:0.5,yOffset:0},Center:{xPercent:0.5,xOffset:0,yPercent:0.5,yOffset:0},Right:{xPercent:1,xOffset:-1,yPercent:0.5,yOffset:0},BottomLeft:{xPercent:0,xOffset:1,yPercent:1,yOffset:-1},Bottom:{xPercent:0.5,xOffset:0,yPercent:1,yOffset:-1},BottomRight:{xPercent:1,xOffset:-1,yPercent:1,yOffset:-3}};function i(F){if(!x[F]){x[F]=new D(F);}return x[F];}function h(J,I,F,G,H){u.prototype.init.call(this,J,I,F,G,H);}h.prototype=new u();h.prototype.evaluate=function(){q.log("Evaluating StandardInviteRule");return u.prototype.evaluate.call(this,this.compareFrom,this.compareTo);};function w(J,I,F,G,H){u.prototype.init.call(this,J,I,F,G,H);}w.prototype=new u();w.prototype.evaluate=function(){var F=new Date().getTime()-this.compareFrom;var G=u.prototype.evaluate.call(this,F,this.compareTo);var H;q.log("Evaluating TimerInviteRule");if(!G&&F<=this.compareTo){H=this.compareTo-F;if(i(this.buttonId).getInviteDelay()===null||H<i(this.buttonId).getInviteDelay()){i(this.buttonId).setInviteDelay(H);}}return G;};function A(J,I,F,G,H){u.prototype.init.call(this,J,I,F,G,H);}A.prototype=new u();A.prototype.evaluate=function(){if(e.hasOwnProperty(this.compareFrom)){q.log("Evaluating CustomInviteRule");return u.prototype.evaluate.call(this,e[this.compareFrom].toString(),this.compareTo);}q.log("CustomInviteRule evaluation failed due to missing custom variable");return false;};function f(I){var H=0;var J=0;var G;var K;var F;p+=1;if(p>1000){throw new Error("Error processing rule filter logic, preventing recursion");}for(G=0;G<I.length;G+=1){if(I.charAt(G)==="("){J+=1;}else{if(I.charAt(G)===")"){J-=1;}}if(I.charAt(G)===","&&J===1){H=G;}}if(I.indexOf("AND(")===0){K=f(I.substring(4,H));F=f(I.substring(H+1,I.length-1));return new y(K,F);}else{if(I.indexOf("OR(")===0){K=f(I.substring(3,H));F=f(I.substring(H+1,I.length-1));return new m(K,F);}else{if(I.indexOf("NOT(")===0){K=f(I.substring(4,I.length-1));return new z(K);}else{if(!isNaN(parseInt(I,10))){return new d(parseInt(I,10));}}}}throw new Error("Encountered unexpected character in filter logic");}function o(K,I,M,J,L,F,H,G){this.buttonId=K;this.element=I;this.hasInviteAfterAccept=F;this.hasInviteAfterReject=H;this.rejectTime=G;if(E(I)===null){this.renderer=new D.RENDERER.Appear.RenderClass(K,I,D.START_POSITION[J],D.END_POSITION[L]);}else{this.renderer=new D.RENDERER[M].RenderClass(K,I,D.START_POSITION[J],D.END_POSITION[L]);}}o.prototype.setState=function(F){if(F&&!n&&i(this.buttonId).trigger()){n=true;this.renderer.render();}else{if(!F&&i(this.buttonId).isActive()){n=false;this.remove(true);}}};o.prototype.renderFinish=function(){var F=this.buttonId;i(this.buttonId).setActive(true);if(this.rejectTime!==-1){i(this.buttonId).setAutoRejectTimeout(window.setTimeout(function(){i(F).rejectInvite();},this.rejectTime*1000));}this.renderer.renderFinish();};o.prototype.accept=function(){if(!this.hasInviteAfterAccept){q.setCookie("liveagent_invite_rejected_"+this.buttonId,true,false);}this.remove(false);};o.prototype.reject=function(){if(!this.hasInviteAfterReject){q.setCookie("liveagent_invite_rejected_"+this.buttonId,true,false);}this.remove(true);};o.prototype.remove=function(F){i(this.buttonId).setActive(false);this.renderer.remove(F);};o.prototype.removeFinish=function(){this.renderer.remove(false);};D.prototype.setRules=function(I,F){var J;var G;var H;if(!I||!F){return;}for(J in I){if(I.hasOwnProperty(J)){G=I[J];H=null;switch(G.type){case u.TYPE.NUMBER_OF_PAGE_VIEWS:H=new h(G.order,this.buttonId,j.getPageCount(),G.operator,parseInt(G.value,10));break;case u.TYPE.URL_MATCH:H=new h(G.order,this.buttonId,j.getCurrentPage(),G.operator,G.value);break;case u.TYPE.SECONDS_ON_PAGE:H=new w(G.order,this.buttonId,new Date().getTime(),G.operator,parseInt(G.value,10)*1000);break;case u.TYPE.SECONDS_ON_SITE:H=new w(G.order,this.buttonId,parseInt(j.getSessionStart(),10),G.operator,parseInt(G.value,10)*1000);break;case u.TYPE.CUSTOM_VARIABLE:H=new A(G.order,this.buttonId,G.name,G.operator,G.value);if(!s.hasOwnProperty(G.name)){s[G.name]=[];}s[G.name].push(this.buttonId);break;default:break;}if(H!==null){this.addRule(H);}}}this.filterLogic=F;this.ruleTree=f(F);};D.prototype.setOnlineState=function(F){if(!F&&this.inviteTimeout!==null){clearTimeout(this.inviteTimeout);this.inviteTimeout=null;}if(!F&&this.autoRejectTimeout!==null){clearTimeout(this.autoRejectTimeout);this.autoRejectTimeout=null;}g.prototype.setOnlineState.call(this,F);};D.prototype.isActive=function(){return this.active;};D.prototype.setActive=function(F){if(document.getElementById(b)){document.getElementById(b).inert=!F;}this.active=F;};D.prototype.addTracker=function(F,H){var G;if(/Mobi/.test(navigator.userAgent)){G=new o(H.id,F,"Fade",undefined,"BottomRight",H.hasInviteAfterAccept,H.hasInviteAfterReject,H.inviteRejectTime);}else{G=new o(H.id,F,H.inviteRenderer,H.inviteStartPosition,H.inviteEndPosition,H.hasInviteAfterAccept,H.hasInviteAfterReject,H.inviteRejectTime);}this.trackers=[];this.trackers.push(G);};D.prototype.getTracker=function(){if(this.trackers.length>1){throw new Error("InviteButtons should have less than 1 tracker");}return this.trackers[0];};D.prototype.acceptInvite=function(){q.onHelpButtonClick();this.getTracker().accept();embedded_svc.utils.fireEvent("onInviteAccepted");};D.prototype.rejectInvite=function(){this.getTracker().reject();embedded_svc.utils.fireEvent("onInviteRejected");};D.prototype.setCustomVariable=function(G,H){var F;e[G]=H;if(s.hasOwnProperty(G)){s[G].forEach(function(I){F=i(I);if(F.getOnlineState()){F.setOnlineState(true);}});}};D.prototype.trigger=function(){var H=true;var F=this;var G=q.componentInitInProgress||document.getElementsByClassName("embeddedServiceSidebar").length>0;if(q.getCookie("liveagent_invite_rejected_"+this.buttonId)||G){return false;}if(this.ruleTree!==null){q.log("Invite "+this.buttonId+" Rule Evaluation");q.log("Filter Logic: "+this.filterLogic);H=this.ruleTree.evaluate(this);}if(!H&&this.inviteDelay!==null){this.inviteTimeout=window.setTimeout(function(){F.setOnlineState(true);},this.inviteDelay);this.inviteDelay=null;}return H;};D.prototype.addRule=function(F){this.rules[F.getId()]=F;};D.prototype.getRule=function(F){return this.rules[F];};D.prototype.getInviteDelay=function(){return this.inviteDelay;};D.prototype.setInviteDelay=function(F){q.log("Setting invite delay to: "+F);this.inviteDelay=F;};D.prototype.setAutoRejectTimeout=function(F){this.autoRejectTimeout=F;};function r(){var F;this.inviteButton=i(q.settings.buttonId);j.init();if(document.getElementById(c)){if(embedded_svc.settings.avatarImgURL){document.getElementById(c).src=embedded_svc.settings.avatarImgURL;}else{F=document.getElementById(c);F.parentNode.removeChild(F);}}}q.inviteAPI=new r();});