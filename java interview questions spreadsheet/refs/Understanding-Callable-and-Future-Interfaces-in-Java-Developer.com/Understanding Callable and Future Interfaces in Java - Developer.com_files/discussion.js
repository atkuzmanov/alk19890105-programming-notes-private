/* OneAll - User Integration Platform | Compiled Thu, 12 Dec 2019 15:17:18 +0100]*/
var oa_loudvoice=oa_social_abstract.extend({args:{},remove_class:function(b,a){oneall.tools.remove_element_class(b,a)},add_class:function(b,a){oneall.tools.add_element_class(b,a)},add_event_listener:function(b,a,c){b.addEventListener?b.addEventListener(a,c):b.attachEvent("on"+a,function(){c.call(b)})},get_offset_top:function(b){for(var a=0;b;)a+=b.offsetTop+b.clientTop,b=b.offsetParent;return parseInt(a,10)},fade_in:function(b){b.style.display="block";b.style.opacity=0;var a=function(){b.style.opacity=
+b.style.opacity+.05;1>+b.style.opacity&&(window.requestAnimationFrame&&requestAnimationFrame(a)||setTimeout(a,16))};a()},xhr:function(b,a){var c;var d=[];for(c in b)d.push(encodeURIComponent(c)+"="+encodeURIComponent(b[c]));"en"!=oneall.cfg.app.language&&d.push("lang="+oneall.cfg.app.language);this.args.author_session_token&&d.push("author_session_token="+this.args.author_session_token);d=d.join("&");var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=
function(){f.readyState==XMLHttpRequest.DONE&&"function"===typeof a&&a(f.status,f.responseText)};f.open("GET","/socialize/loudvoice/discussion/worker/?"+d,!0);f.send()},recalc_textarea_height:function(b){if("object"===typeof b&&"nodeType"in b){b.style.boxSizing="border-box";b.style.mozBoxSizing="border-box";b.style.overflowY="hidden";var a=parseInt(window.getComputedStyle(b).height,10)-b.clientHeight;b.style.height=0;b.style.height=20*Math.round(Math.max(b.style.minHeight,b.scrollHeight+
a)/20)+"px";this.recalc_iframe_height()}},recalc_iframe_height:function(){var b=document.body;var a=document.documentElement;this.xd_poster("rif|"+this.args.iframeid+"|100%|"+Math.min(b.scrollHeight,a.scrollHeight,b.offsetHeight,a.offsetHeight))},add_reply_form:function(b,a){var c=document.getElementById("answer_template");"undefined"!==typeof c&&null!==c&&this.inject_reply_form(b,a,c)},inject_reply_form:function(b,a,c){var d,f,g,e=this;a="undefined"===typeof a?"":a;c=c.cloneNode(!0);c.setAttribute("data-reply-to",
a);c.removeAttribute("id");if(g="undefined"!==typeof e.args.error_comment_token&&e.args.error_comment_token==a)"undefined"!==typeof e.args.comment_error&&(c.getElementsByClassName("post_error")[0].innerHTML=e.args.comment_error),"undefined"!==typeof e.args.comment_text&&(c.getElementsByClassName("post_input")[0].innerHTML=e.args.comment_text);c.onsubmit=function(){e.args.reply_to_comment_token=this.getAttribute("data-reply-to");this.getElementsByClassName("args")[0].value=oneall.tools.json_stringify(e.args)};
if((d=c.getElementsByClassName("post_input"))&&d.length){var h=d[0];oneall.loader.add_event(function(){e.recalc_textarea_height(h)});g||(c.getElementsByClassName("login_wrap")[0].style.display="none");var k=function(b,a,c){return function(){var b;a.removeAttribute("placeholder");if(oneall.tools.has_element_class(c,"with_editor")){var d=new LVCM({element:a,promptURLs:!0,toolbar:"bold italic heading quote | unordered-list ordered-list | link image | preview redo undo".split(" ")});d.codemirror.on("viewportChange",
function(){e.recalc_iframe_height()})}else e.add_class(a,"focussed");(b=c.getElementsByClassName("login_wrap"))&&b.length&&"none"==b[0].style.display&&(e.fade_in(b[0]),e.recalc_iframe_height())}};e.add_event_listener(h,"focus",k(this,h,c));k=function(b,a){return function(){b.recalc_textarea_height(a)}};e.add_event_listener(h,"input",k(this,h));e.add_event_listener(h,"propertychange",k(this,h))}d=c.getElementsByClassName("author_avatar");var l=0;for(f=d.length;l<f;l+=1)d[l].onerror=function(){this.src=
"https://www.gravatar.com/avatar/00000000000000000000000000000000?s=48&d=mm";e.add_class(this,"broken")};k=function(b){return function(){var a;var c=b.getElementsByClassName("input_boxes_hidden");if(2<this.value.length){var d=0;for(a=c.length;d<a;d+=1)"block"!=c[d].style.display&&e.fade_in(c[d])}}};d=c.getElementsByClassName("user_input_email");l=0;for(f=d.length;l<f;l+=1)d[l].onkeydown=k(c);k=function(b){return function(){e.user_logout();return!1}};d=c.getElementsByClassName("logout_link");l=0;for(f=
d.length;l<f;l+=1)d[l].onclick=k();if(0<this.providers.length)for(d=c.getElementsByClassName("social_login_providers"),l=0,f=d.length;l<f;l+=1)this.disable_popups=!1,this.show_providers_in_container(d[l]);else for(d=c.getElementsByClassName("author_login"),l=0,f=d.length;l<f;l+=1)e.remove_class(d[l],"social");frm=b.appendChild(c);(g||0<a.length)&&frm.getElementsByClassName("post_input")[0].focus();return frm},close_all_reply_boxes:function(){var b;var a=oneall.tools.get_elements_by_class_name("replying");
var c=0;for(b=a.length;c<b;c+=1)this.close_reply_box(a[c].getAttribute("data-token"))},close_reply_box:function(b){var a;(a=document.getElementById("comment_"+b))&&oneall.tools.has_element_class(a,"replying")&&(b=document.getElementById(a.id+"_reply"),b.parentNode.removeChild(b),this.remove_class(a,"replying"),a.removeAttribute("data-replying"),this.recalc_iframe_height())},open_reply_box:function(b){var a;if((a=document.getElementById("comment_"+b))&&!oneall.tools.has_element_class(a,"replying")){this.close_all_reply_boxes();
this.add_class(a,"replying");a.setAttribute("data-replying",1);var c=document.createElement("div");c.setAttribute("class","action_box action_box_reply");c.setAttribute("id",a.id+"_reply");c.setAttribute("data-target",a.id);c=a.getElementsByClassName("footer")[0].appendChild(c);this.add_reply_form(c,b);this.recalc_iframe_height()}},setup_discussion_events:function(b){var a,c=this;var d=oneall.tools.get_elements_by_class_name("discussion_action_recommend");var f=0;for(a=d.length;f<a;f+=1)d[f].onclick=
function(){oneall.tools.has_element_class(this,"active")||oneall.tools.has_element_class(this,"locked")||c.recommend_discussion();return!1};d=oneall.tools.get_elements_by_class_name("discussion_action_share");f=0;for(a=d.length;f<a;f+=1)d[f].onclick=function(){c.share_discussion(this.getAttribute("data-method"));return!1};d=oneall.tools.get_elements_by_class_name("discussion_action_sort");f=0;for(a=d.length;f<a;f+=1)d[f].onclick=function(){oneall.tools.has_element_class(this,"active")||oneall.tools.has_element_class(this,
"locked")||c.display_discussion(this.getAttribute("data-direction"),c.args.comment_depth);return!1};"undefined"!==typeof b&&"undefined"!==typeof c.args.error_comment_token&&b==c.args.error_comment_token&&c.open_reply_box(b);c.recalc_iframe_height();d=document.getElementsByTagName("img");var g=d.length;var e=0;var h=function(a,d){e++;a.setAttribute("data-loaded",d);e>=g&&(c.recalc_iframe_height(),0<b.length&&c.scroll_to_comment(b))};f=0;for(a=g;f<a;f+=1)d[f].complete?h(d[f],"initial"):(d[f].onload=
function(){h(this,"deferred")},d[f].onerror=function(){h(this,"broken")})},report_comment:function(b,a){var c;if(c=document.getElementById("comment_"+b)){var d=function(b,a){200==b&&(c.setAttribute("data-reported",1),c.setAttribute("class",c.className+" comment_reported"))};this.xhr({action:"report",report:!1!==a?"set":"unset",comment_token:b},d)}},setup_comment_events:function(){var b,a,c,d,f,g,e=this;var h=oneall.tools.get_elements_by_class_name("writer_avatar");var k=0;for(b=h.length;k<b;k+=1)h[k].onerror=
function(){this.src="https://www.gravatar.com/avatar/00000000000000000000000000000000?s=48&d=mm";e.add_class(this,"broken")};h=oneall.tools.get_elements_by_class_name("comment_anchor");k=0;for(b=h.length;k<b;k+=1)h[k].onclick=function(){(c=this.getAttribute("href"))&&(f=c.split("#")[1])&&(a=document.getElementById(f))&&e.xd_poster("stp|"+e.args.iframeid+"|"+(a.getBoundingClientRect().top-e.args.offset_top))};h=oneall.tools.get_elements_by_class_name("comment_action");k=0;for(b=h.length;k<b;k+=1)h[k].onclick=
function(){c=this.parentNode.getAttribute("data-target");d=this.getAttribute("data-action");f=c.split("_")[1];y1=0;c&&d&&(g=document.getElementById(c))&&("link"==d?(e.highlight_comment(f),e.xd_poster("rta|"+c),e.xd_poster("stp|"+e.args.iframeid+"|"+(e.get_offset_top(g)-e.args.offset_top))):"collapse"==d?(oneall.tools.has_element_class(g,"collapsed")?e.remove_class(g,"collapsed"):e.add_class(g,"collapsed"),e.recalc_iframe_height()):"report"==d?g.getAttribute("data-reported")||e.xd_poster("prc|Report this comment as spam or inappropriate comment?|report|"+
c+"|"+document.location+"|"+e.args.iframeid):"vote_up"==d||"vote_down"==d?(func=function(b,a){if(200==b&&(a=oneall.tools.json_parse(a),"undefined"!==typeof a.status))if("success"==a.status){var c=g.getElementsByClassName("comment_counter_votes")[0];c.innerHTML=0==a.votes?"":a.votes;c=g.getElementsByClassName("action_group_voting")[0];0==a.votes?e.remove_class(c,"action_group_has_votes"):e.add_class(c,"action_group_has_votes")}else"error_vote_own"==a.status?e.xd_poster("art|You cannot vote for your own comments."):
"error_vote_multiple"==a.status?e.xd_poster("art|You have already voted for this comment."):"error_vote_guest"==a.status?e.xd_poster("art|Please login to leave your vote."):alert(a.status)},e.xhr({action:d,comment_token:f},func)):"reply"==d&&(g.getAttribute("data-replying")?e.close_reply_box(f):e.open_reply_box(f)));return!1};h=oneall.tools.get_elements_by_class_name("more");k=0;for(b=h.length;k<b;k+=1)h[k].onclick=function(){e.display_more_comments(this.getAttribute("id"));return!1}},init:function(b){var a;
var c=this;c._super("loudvoice",b);c.args=b;c.push_author_session_token();var d=null;var f=!1;"undefined"!==typeof c.args.error_comment_token?d=c.args.error_comment_token:"undefined"!==typeof c.args.new_comment&&0<c.args.new_comment.length?(d=c.args.new_comment,f=!0):(b=c.args.parent_uri.split("#comment_"),2==b.length&&(d=b[1],f=!0));(a=document.getElementById("post_comment_form"))&&this.add_reply_form(a);c.display_discussion(c.args.comment_direction,c.args.comment_depth,d,f);oneall.xd.receiveMessage(function(a){a=
a.data.split("|");2==a.length&&("report"==a[0]?(a=a[1].split("comment_"),2==a.length&&c.report_comment(a[1])):0<=a[0].indexOf("callback")&&(a=oneall.tools.json_parse(a[1]),a.connection.status&&"success"==a.connection.status&&c.user_login(a.connection.token)))},document.location);this.trigger("widget_loaded",{iframeid:c.args.iframeid})},scroll_to_comment:function(b){var a;if(a=document.getElementById("comment_"+b)){a=this.get_offset_top(a);var c=parseInt(this.args.offset_top,10);var d=a-c;0>d?oneall.console.log("[LOUDVOICE] Cannot scroll to comment "+
b+". The specified offset "+c+" exceeds the comment position "+a):this.xd_poster("stp|"+this.args.iframeid+"|"+d)}},highlight_comment:function(b){var a;if(b=document.getElementById("comment_"+b)){var c=oneall.tools.has_element_class(b,"selected");var d=oneall.tools.get_elements_by_class_name("selected");var f=0;for(a=d.length;f<a;f+=1)this.remove_class(d[f],"selected");c||this.add_class(b,"selected")}},pull_author_session_token:function(){var b=document.getElementById("loudvoice").getAttribute("data-session-token");
return"string"==typeof b&&b.length?b:""},push_author_session_token:function(b){"undefined"===typeof b&&(b=this.pull_author_session_token());this.xd_poster("ast|"+b)},set_author_login:function(b,a){var c=document.getElementById("loudvoice");!0===b&&"undefined"!==typeof a?(this.args.author_session_token=a,this.add_class(c,"status_logged_in"),c.setAttribute("data-session-token",a)):(this.args.author_session_token="",this.remove_class(c,"status_logged_in"),c.removeAttribute("data-session-token"));this.push_author_session_token()},
set_author_data:function(b,a,c){var d,f=this;a="undefined"!==typeof a?a:"";c="undefined"!==typeof c?c:"";var g=oneall.tools.get_elements_by_class_name("author_avatar");var e=0;for(d=g.length;e<d;e+=1)g[e].src=a;g=oneall.tools.get_elements_by_class_name("author_name");e=0;for(d=g.length;e<d;e+=1)g[e].innerHTML=c,g[e].onerror=function(){this.src="https://www.gravatar.com/avatar/00000000000000000000000000000000?s=48&d=mm";f.add_class(this,"broken")};b=!0===b&&0<c.length?"Post as "+c.replace(/</g,
"&lt;").replace(/>/g,"&gt;"):"Post Comment";g=oneall.tools.get_elements_by_class_name("button_post_comment");e=0;for(d=g.length;e<d;e+=1)g[e].innerHTML=b},trigger:function(b,a){var c="on_"+b;a="undefined"!==typeof a?a:{};a.event=c;a.iframeid=this.args.iframeid;this.xd_poster("cat|"+c+"|"+oneall.tools.json_stringify(a))},notify_new_comment:function(b,a,c){this.trigger("comment_added",{author_token:b,comment_token:a,discussion_token:c})},user_logout:function(){var b,a,c;var d=this;this.xhr({action:"logout"},
function(f,g){if(200==f&&(g=oneall.tools.json_parse(g),"undefined"!==typeof g.status&&"success"==g.status)){if(!d.args.enable_any_login)for(b=oneall.tools.get_elements_by_class_name("loggedin_only"),a=0,c=b.length;a<c;a+=1)b[a].parentNode.removeChild(b[a]);d.set_author_data(!1,g.default_avatar);d.set_author_login(!1);d.recalc_iframe_height();d.trigger("logout_end_success",g)}})},user_login:function(b){var a,c,d,f=this;this.xhr({action:"login",provider_connection_token:b},function(b,e){if(200==b&&
(e=oneall.tools.json_parse(e),"undefined"!==typeof e.status&&"success"==e.status)){f.set_author_data(!0,e.author.avatar,e.author.name);f.set_author_login(!0,e.author_session.author_session_token);a=oneall.tools.get_elements_by_class_name("post_error");c=0;for(d=a.length;c<d;c+=1)a[c].innerHTML="";f.recalc_iframe_height();f.trigger("login_end_success",e)}})},update_comments_counter:function(b){var a;if(a=document.getElementById("discussion_comments_count"))a.innerHTML=b+" "+(1==b?"Comment":"Comments"),
a=document.getElementById("discussion_actions_sort"),1>=b?this.add_class(a,"unsortable"):this.remove_class(a,"unsortable")},update_recommendation_link:function(b){var a;if(a=document.getElementById("discussion_recommend")){var c=document.getElementById("discussion_recommend_text");this.remove_class(a,"locked");b?(this.add_class(a,"recommended"),c.innerHTML="Recommended"):(this.remove_class(a,"recommended"),c.innerHTML="Recommend")}},share_discussion:function(b){var a={};a.url=this.args.page_url;
a.title=this.args.page_title;a.service=b;b=oneall.cfg.get_uri("sharing_bookmark")+"?opts="+encodeURIComponent(oneall.tools.json_stringify(a));window.open(b,"_blank")},recommend_discussion:function(){var b=this;var a=document.getElementById("discussion");func=function(a,d){200==a&&(d=oneall.tools.json_parse(d),"undefined"!==typeof d.status&&"recommended"==d.status?b.update_recommendation_link(!0):b.update_recommendation_link(!1))};b.xhr({action:"recommend_discussion",discussion_token:a.getAttribute("data-token")},
func)},display_discussion:function(b,a,c,d){var f,g=this;c=c||"";document.getElementById("loudvoice");var e=document.getElementById("discussion");if(oneall.tools.has_element_class(e,"trashed"))g.recalc_iframe_height();else{g.add_class(e,"loading");if(null===b||0==b.length)b=e.getAttribute("data-default-direction");var h=oneall.tools.get_elements_by_class_name("discussion_post_sort");var k=0;for(f=h.length;k<f;k+=1)h[k].value=b;h=oneall.tools.get_elements_by_class_name("discussion_action_sort");k=
0;for(f=h.length;k<f;k+=1){var l=h[k];g.add_class(l,"locked");l.getAttribute("data-direction")==b&&g.add_class(l,"loading")}var n=document.getElementById("discussion_comments");func=function(a,f){var k;if(200==a){n.innerHTML="";if(0<f.length&&(f=oneall.tools.json_parse(f),g.update_recommendation_link(f.has_recommended),0<f.num_comments_tot)){g.update_comments_counter(f.num_comments_tot);g.remove_class(e,"no_comments");var h=document.createElement("div");h.innerHTML=f.html;h=h.childNodes;var m=0;for(k=
h.length;m<k;m+=1)n.appendChild(h[m].cloneNode(!0));0<c.length&&!0===d&&g.highlight_comment(c)}e.setAttribute("data-direction",b);h=oneall.tools.get_elements_by_class_name("discussion_action_sort");m=0;for(k=h.length;m<k;m+=1)h[m].getAttribute("data-direction")==b?g.add_class(h[m],"active"):g.remove_class(h[m],"active");g.setup_comment_events()}else g.update_comments_counter(0),more_el.innerHTML="Could not load comments",g.add_class(more_el,"error");m=0;for(k=h.length;m<k;m+=1)l=h[m],g.remove_class(l,
"locked"),g.remove_class(l,"loading");g.remove_class(e,"loading");g.setup_discussion_events(c)};g.xhr({action:"reload_discussion",discussion_token:e.getAttribute("data-token")||"",comment_token:c,direction:b,depth:a.join("-")},func)}},display_more_comments:function(b){var a=this;var c=document.getElementById("discussion");var d=document.getElementById(b);a.add_class(d,"loading");func=function(b,c){var e;if(200==b){c=oneall.tools.json_parse(c);if(0<c.num_comments_returned){var f=document.createElement("div");
f.innerHTML=c.html;f=f.childNodes;var g=0;for(e=f.length;g<e;g+=1)d.parentNode.appendChild(f[g].cloneNode(!0))}d.parentNode.removeChild(d);a.setup_comment_events()}else d.innerHTML="Could not load comments",a.add_class(d,"error");a.remove_class(d,"loading");a.recalc_iframe_height()};a.xhr({action:"load_more_comments",comment_token:b.split("_")[1],direction:c.getAttribute("data-direction"),depth:a.args.comment_depth.join("-")},func)}});