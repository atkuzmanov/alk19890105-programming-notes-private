function editorGetSelectedHtml(a){var b=editorGetIFrame(a);if(jQuery.isFunction(b.getSelectedHTML)){return b.getSelectedHTML()}else if(xIE4Up){var c=b.contentWindow.document.selection.createRange();var d=c.htmlText;return d}else{var c=b.contentWindow.getSelection().getRangeAt(0);var e=xCreateElement("div");e.appendChild(c.cloneContents());var d=xInnerHtml(e);return d}}function editorReplaceHTML(a,b){var c=/src=("|\'){1}(\.\/)?(files\/attach|files\/cache|files\/faceOff|files\/member_extra_info|modules|common|widgets|widgetstyle|layouts|addons)\/([^"\']+)\.(jpg|jpeg|png|gif)("|\'){1}/g;b=b.replace(c,'src="'+request_uri+'$3/$4.$5"');var d=/href=("|\'){1}(\.\/)?\?([^"\']+)("|\'){1}/g;b=b.replace(d,'href="'+request_uri+'?$3"');var e=a.editor_sequence||a.contentWindow.document.body.getAttribute("editor_sequence");try{a.contentWindow.focus()}catch(f){}if(jQuery.isFunction(a.replaceHTML)){a.replaceHTML(b)}else if(xIE4Up){var g=a.contentWindow.document.selection.createRange();if(g.pasteHTML){g.pasteHTML(b)}else if(editorPrevNode){editorPrevNode.outerHTML=b}}else{try{if(a.contentWindow.getSelection().focusNode.tagName=="HTML"){var g=a.contentDocument.createRange();g.setStart(a.contentDocument.body,0);g.setEnd(a.contentDocument.body,0);g.insertNode(g.createContextualFragment(b))}else{var g=a.contentWindow.getSelection().getRangeAt(0);g.deleteContents();g.insertNode(g.createContextualFragment(b))}}catch(f){xInnerHtml(a.contentWindow.document.body,b+xInnerHtml(a.contentWindow.document.body))}}}function editorSearchComponent(a){var b=new xEvent(a);editorPrevNode=null;var c=b.target;if(c.getAttribute("widget")){var d=c;while(d&&d.nodeName!="BODY"){d=xParent(d)}if(!d||d.nodeName!="BODY"||!d.getAttribute("editor_sequence")){editorPrevNode=null;return}var e=d.getAttribute("editor_sequence");var f=c.getAttribute("widget");editorPrevNode=c;if(editorMode[e]=="html")return;popopen(request_uri+"?module=widget&act=dispWidgetGenerateCodeInPage&selected_widget="+f+"&module_srl="+e,"GenerateCodeInPage");return}if(!c.getAttribute("editor_component")){while(c&&!c.getAttribute("editor_component")){if(c.parentElement)c=c.parentElement;else c=xParent(c)}}if(!c)c=b.target;var g=c.getAttribute("editor_component");if(!g){if(c.nodeName=="IMG"){g="image_link";editorPrevNode=c}}else{editorPrevNode=c}if(!g){editorPrevNode=null;return}var d=c;while(d&&d.nodeName!="BODY"){d=xParent(d)}if(!d||d.nodeName!="BODY"||!d.getAttribute("editor_sequence")){editorPrevNode=null;return}var e=d.getAttribute("editor_sequence");openComponent(g,e)}function openComponent(a,b,c){editorPrevSrl=b;if(editorMode[b]=="html")return;var d=request_uri+"?module=editor&act=dispEditorPopup&editor_sequence="+b+"&component="+a;if(typeof c!="undefined"&&c)d+="&manual_url="+escape(c);popopen(d,"editorComponent")}function editorEventCheck(a){editorPrevNode=null;var b=a.target.id;if(!b)return;var c=b.split("_");if(c[0]!="component")return;var d=c[1];var e=b.replace(/^component_[0-9]+_/,"");if(!d||!e)return;if(editorMode[d]=="html")return;switch(e){case"Bold":case"Italic":case"Underline":case"StrikeThrough":case"undo":case"redo":case"JustifyLeft":case"JustifyCenter":case"JustifyRight":case"JustifyFull":case"Indent":case"Outdent":case"InsertOrderedList":case"InsertUnorderedList":case"SaveAs":case"Print":case"Copy":case"Cut":case"Paste":case"RemoveFormat":case"Subscript":case"Superscript":editorDo(e,"",d);break;default:openComponent(e,d);return false}return}function eOptionClick(a){a.style.marginTop="-42px";a.style.zIndex="99"}function eOptionOut(a){a.style.marginTop="0";a.style.zIndex="1"}function eOptionOver(a){a.style.marginTop="-21px";a.style.zIndex="99"}function editorGetTextarea(a){return document.getElementById("editor_textarea_"+a)}function editorGetIFrame(a){if(editorRelKeys!=undefined&&editorRelKeys[a]!=undefined&&editorRelKeys[a]["editor"]!=undefined)return editorRelKeys[a]["editor"].getFrame(a);return document.getElementById("editor_iframe_"+a)}function editorRemoveSavedDoc(){var a=new Array;a["mid"]=current_mid;exec_xml("editor","procEditorRemoveSavedDoc",a)}function _editorAutoSave(a,b){var c=editorAutoSaveObj.fo_obj;var d=editorAutoSaveObj.editor_sequence;if(!a){clearTimeout(editorEnableAutoSave.timer);editorEnableAutoSave.timer=setTimeout(function(){_editorAutoSave(a,b)},5e4)}if(editorAutoSaveObj.locked==true)return;if(!c||typeof c.title=="undefined"||!d)return;var e=c.title.value;var f="";try{f=editorGetContent(d)}catch(g){}if(e!=editorAutoSaveObj.title||f!=editorAutoSaveObj.content||a){var h,i=new Date;h={title:e,content:f,mid:current_mid,document_srl:editorRelKeys[d]["primary"].value};editorAutoSaveObj.title=e;editorAutoSaveObj.content=f;jQuery("#editor_autosaved_message_"+d).text(i.getHours()+":"+i.getMinutes()+" "+auto_saved_msg).show(300);editorAutoSaveObj.locked=true;show_waiting_message=false;exec_xml("editor","procEditorSaveDoc",h,function(){var a=jQuery.extend({},h,{auto_saved_msg:auto_saved_msg});editorAutoSaveObj.locked=false;if(jQuery.isFunction(b))b(a)});show_waiting_message=true}}function editorEnableAutoSave(a,b,c){var d=a.title.value;var e=editorRelKeys[b]["content"].value;editorAutoSaveObj={fo_obj:a,editor_sequence:b,title:d,content:e,locked:false};clearTimeout(editorEnableAutoSave.timer);editorEnableAutoSave.timer=setTimeout(function(){_editorAutoSave(false,c)},5e4)}function editorFocus(a){try{var b=editorGetIFrame(a);if(jQuery.isFunction(b.setFocus)){b.setFocus()}else{b.contentWindow.focus()}}catch(c){}}function editorGetContent(a){var b=editorRelKeys[a]["func"](a);var c=new RegExp(request_uri.replace(/\//g,"\\/")+"(files|common|modules|layouts|widgets)","ig");return b.replace(c,"$1")}var editorMode=new Array;var editorAutoSaveObj={fo_obj:null,editor_sequence:0,title:"",content:"",locked:false};var editorRelKeys=new Array;var editorDragObj={isDrag:false,y:0,obj:null,id:"",det:0,source_height:0};editorEnableAutoSave.timer=null;var editorPrevSrl=null;jQuery(document).click(editorEventCheck);var editorPrevNode=null;(function(a){function j(h){a("#xeEditorMask_"+e).hide();if(!b)return;a(document).unbind("mousemove",i);if(a.isFunction(window.fixAdminLayoutFooter)){var j=parseInt(g.eq(0).css("height"))-d;fixAdminLayoutFooter(j)}b=false;c=0;f=null;g=null;e="";return false}function i(f){if(!b){a("#xeEditorMask_"+e).hide();return}var h=f.pageY-c;g.css("height",d+h+"px");return false}function h(h){var j=a(h.target);var k=j.attr("id");if(!k||!/^editor_drag_bar_(.+)$/.test(k))return;b=true;c=h.pageY;f=j;e=RegExp.$1;var l=a(editorGetIFrame(e));var m=a(editorGetTextarea(e));var n=a("#editor_preview_"+e);var o=l.is(":visible")?l:m;d=parseInt(o.css("height"));g=a([l[0],m[0]]);if(n.length)g.add(n[0]);if(!isNaN(d)||!d){var p=o[0].offsetHeight;o.css("height",p+"px");var q=o[0].offsetHeight;d=p*2-q;g.css("height",d+"px")}a("#xeEditorMask_"+e).show();a(document).mousemove(i);return false}var b=false;var c=0;var d=0;var e="";var f=null;var g=null})(jQuery)