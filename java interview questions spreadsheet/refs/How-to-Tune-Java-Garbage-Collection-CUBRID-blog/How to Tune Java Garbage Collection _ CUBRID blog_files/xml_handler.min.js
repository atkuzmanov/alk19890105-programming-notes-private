var show_waiting_message=true;function xml2json(c,d,b){var g={toObj:function(j){var p={};if(j.nodeType==1){if(b&&j.attributes.length){for(var m=0;m<j.attributes.length;m++){p["@"+j.attributes[m].nodeName]=(j.attributes[m].nodeValue||"").toString()}}if(j.firstChild){var h=0,l=0,k=false;for(var q=j.firstChild;q;q=q.nextSibling){if(q.nodeType==1){k=true}else{if(q.nodeType==3&&q.nodeValue.match(/[^ \f\n\r\t\v]/)){h++}else{if(q.nodeType==4){l++}}}}if(k){if(h<2&&l<2){g.removeWhite(j);for(var q=j.firstChild;q;q=q.nextSibling){if(q.nodeType==3){p=g.escape(q.nodeValue)}else{if(q.nodeType==4){p=g.escape(q.nodeValue)}else{if(p[q.nodeName]){if(p[q.nodeName] instanceof Array){p[q.nodeName][p[q.nodeName].length]=g.toObj(q)}else{p[q.nodeName]=[p[q.nodeName],g.toObj(q)]}}else{p[q.nodeName]=g.toObj(q)}}}}}else{if(!j.attributes.length){p=g.escape(g.innerXml(j))}else{p["#text"]=g.escape(g.innerXml(j))}}}else{if(h){if(!j.attributes.length){p=g.escape(g.innerXml(j))}else{p["#text"]=g.escape(g.innerXml(j))}}else{if(l){if(l>1){p=g.escape(g.innerXml(j))}else{for(var q=j.firstChild;q;q=q.nextSibling){p=g.escape(q.nodeValue)}}}}}}if(!j.attributes.length&&!j.firstChild){p=null}}else{if(j.nodeType==9){p=g.toObj(j.documentElement)}else{alert("unhandled node type: "+j.nodeType)}}return p},toJson:function(r,k,q){var p=k?('"'+k+'"'):"";if(r instanceof Array){for(var l=0,s=r.length;l<s;l++){r[l]=g.toJson(r[l],"",q+"\t")}p+=(k?":[":"[")+(r.length>1?("\n"+q+"\t"+r.join(",\n"+q+"\t")+"\n"+q):r.join(""))+"]"}else{if(r==null){p+=(k&&":")+"null"}else{if(typeof(r)=="object"){var j=[];for(var h in r){j[j.length]=g.toJson(r[h],h,q+"\t")}p+=(k?":{":"{")+(j.length>1?("\n"+q+"\t"+j.join(",\n"+q+"\t")+"\n"+q):j.join(""))+"}"}else{if(typeof(r)=="string"){p+=(k&&":")+'"'+r.toString()+'"'}else{p+=(k&&":")+r.toString()}}}}return p},innerXml:function(j){var i="";if("innerHTML" in j){i=j.innerHTML}else{var h=function(p){var m="";if(p.nodeType==1){m+="<"+p.nodeName;for(var l=0;l<p.attributes.length;l++){m+=" "+p.attributes[l].nodeName+'="'+(p.attributes[l].nodeValue||"").toString()+'"'}if(p.firstChild){m+=">";for(var o=p.firstChild;o;o=o.nextSibling){m+=h(o)}m+="</"+p.nodeName+">"}else{m+="/>"}}else{if(p.nodeType==3){m+=p.nodeValue}else{if(p.nodeType==4){m+="<![CDATA["+p.nodeValue+"]]>"}}}return m};for(var k=j.firstChild;k;k=k.nextSibling){i+=h(k)}}return i},escape:function(h){return h.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(i){i.normalize();for(var j=i.firstChild;j;){if(j.nodeType==3){if(!j.nodeValue.match(/[^ \f\n\r\t\v]/)){var h=j.nextSibling;i.removeChild(j);j=h}else{j=j.nextSibling}}else{if(j.nodeType==1){g.removeWhite(j);j=j.nextSibling}else{j=j.nextSibling}}}return i}};if(c.nodeType==9){c=c.documentElement}var f=g.toObj(g.removeWhite(c)),a;if(typeof(JSON)=="object"&&jQuery.isFunction(JSON.stringify)&&false){var e={};e[c.nodeName]=f;a=JSON.stringify(e);return a}else{a=g.toJson(f,c.nodeName,"");return"{"+(d?a.replace(/\t/g,d):a.replace(/\t|\n/g,""))+"}"}}(function($){$.exec_xml=window.exec_xml=function(module,act,params,callback_func,response_tags,callback_func_arg,fo_obj){var xml_path=request_uri+"index.php";if(!params){params={}}if($.isArray(params)){params=arr2obj(params)}params.module=module;params.act=act;if(typeof(xeVid)!="undefined"){params.vid=xeVid}if(typeof(response_tags)=="undefined"||response_tags.length<1){response_tags=["error","message"]}else{response_tags.push("error","message")}if($.isArray(ssl_actions)&&params.act&&$.inArray(params.act,ssl_actions)>=0){var url=default_url||request_uri;var port=window.https_port||443;var _ul=$("<a>").attr("href",url)[0];var target="https://"+_ul.hostname.replace(/:\d+$/,"");if(port!=443){target+=":"+port}if(_ul.pathname[0]!="/"){target+="/"}target+=_ul.pathname;xml_path=target.replace(/\/$/,"")+"/index.php"}var _u1=$("<a>").attr("href",location.href)[0];var _u2=$("<a>").attr("href",xml_path)[0];if(_u1.protocol!=_u2.protocol||_u1.port!=_u2.port){return send_by_form(xml_path,params)}var xml=[],i=0;xml[i++]='<?xml version="1.0" encoding="utf-8" ?>';xml[i++]="<methodCall>";xml[i++]="<params>";var setFormKey=false;$.each(params,function(key,val){xml[i++]="<"+key+"><![CDATA["+val+"]]></"+key+">";if(key==form_key_name){setFormKey=true}});if(!setFormKey&&(typeof form_key!="undefined")&&(typeof form_key_name!="undefined")){xml[i++]="<"+form_key_name+"><![CDATA["+form_key+"]]></"+form_key_name+">"}xml[i++]="</params>";xml[i++]="</methodCall>";var _xhr=null;if(_xhr&&_xhr.readyState!=0){_xhr.abort()}function onsuccess(data,textStatus,xhr){var resp_xml=$(data).find("response")[0],resp_obj,txt="",ret=[],tags={},json_str="";waiting_obj.css("display","none").trigger("cancel_confirm");if(!resp_xml){alert(_xhr.responseText);return null}json_str=xml2json(resp_xml,false,false);resp_obj=(typeof(JSON)=="object"&&$.isFunction(JSON.parse))?JSON.parse(json_str):eval("("+json_str+")");resp_obj=resp_obj.response;if(typeof(resp_obj)=="undefined"){ret.error=-1;ret.message="Unexpected error occured.";try{if(typeof(txt=resp_xml.childNodes[0].firstChild.data)!="undefined"){ret.message+="\r\n"+txt}}catch(e){}return ret}$.each(response_tags,function(key,val){tags[val]=true});tags.redirect_url=true;tags.act=true;$.each(resp_obj,function(key,val){if(tags[key]){ret[key]=val}});if(ret.error!=0){if($.isFunction($.exec_xml.onerror)){return $.exec_xml.onerror(module,act,ret,callback_func,response_tags,callback_func_arg,fo_obj)}alert((ret.message||"An unknown error occured while loading ["+module+"."+act+"]").replace(/\\n/g,"\n"));return null}if(ret.redirect_url){location.href=ret.redirect_url.replace(/&amp;/g,"&");return null}if($.isFunction(callback_func)){callback_func(ret,response_tags,callback_func_arg,fo_obj)}}try{$.ajax({url:xml_path,type:"POST",dataType:"xml",data:xml.join("\n"),contentType:"text/plain",beforeSend:function(xhr){_xhr=xhr},success:onsuccess,error:function(xhr,textStatus){waiting_obj.css("display","none");var msg="";if(textStatus=="parsererror"){msg="The result is not valid XML :\n-------------------------------------\n";if(xhr.responseText==""){return}msg+=xhr.responseText.replace(/<[^>]+>/g,"")}else{msg=textStatus}try{console.log(msg)}catch(ee){}}})}catch(e){alert(e);return}var waiting_obj=$(".wfsr");if(show_waiting_message&&waiting_obj.length){waiting_obj.html(waiting_message).show()}};function send_by_form(url,params){var frame_id="xeTmpIframe";var form_id="xeVirtualForm";if(!$("#"+frame_id).length){$('<iframe name="%id%" id="%id%" style="position:absolute;left:-1px;top:1px;width:1px;height:1px"></iframe>'.replace(/%id%/g,frame_id)).appendTo(document.body)}$("#"+form_id).remove();var form=$('<form id="%id%"></form>'.replace(/%id%/g,form_id)).attr({id:form_id,method:"post",action:url,target:frame_id});params.xeVirtualRequestMethod="xml";params.xeRequestURI=location.href.replace(/#(.*)$/i,"");params.xeVirtualRequestUrl=request_uri;$.each(params,function(key,value){$('<input type="hidden">').attr("name",key).attr("value",value).appendTo(form)});form.appendTo(document.body).submit()}function arr2obj(arr){var ret={};for(var key in arr){if(arr.hasOwnProperty(key)){ret[key]=arr[key]}}return ret}$.exec_json=function(action,data,func){if(typeof(data)=="undefined"){data={}}if(typeof form_key!="undefined"&&typeof form_key_name!="undefined"){data[form_key_name]=form_key}action=action.split(".");if(action.length==2){if(show_waiting_message){$(".wfsr").html(waiting_message).show()}$.extend(data,{module:action[0],act:action[1]});if(typeof(xeVid)!="undefined"){$.extend(data,{vid:xeVid})}$.ajax({type:"POST",dataType:"json",url:request_uri,contentType:"application/json",data:$.param(data),success:function(data){$(".wfsr").hide().trigger("cancel_confirm");if(data.error>0){alert(data.message)}if($.isFunction(func)){func(data)}}})}};$.fn.exec_html=function(action,data,type,func,args){if(typeof(data)=="undefined"){data={}}if(!$.inArray(type,["html","append","prepend"])){type="html"}var self=$(this);action=action.split(".");if(action.length==2){if(show_waiting_message){$(".wfsr").html(waiting_message).show()}$.extend(data,{module:action[0],act:action[1]});$.ajax({type:"POST",dataType:"html",url:request_uri,data:$.param(data),success:function(html){$(".wfsr").hide().trigger("cancel_confirm");self[type](html);if($.isFunction(func)){func(args)}}})}};function beforeUnloadHandler(){return""}$(function($){$(".wfsr").ajaxStart(function(){$(window).bind("beforeunload",beforeUnloadHandler)}).bind("ajaxStop cancel_confirm",function(){$(window).unbind("beforeunload",beforeUnloadHandler)})})})(jQuery);