function LogicHop(o){this.data=o,this.payload={},this.data.js_track||this.setCookie(this.data.cookie)}if(LogicHop.prototype.addPayloadData=function(o,e){this.payload[o]=e},LogicHop.prototype.setCookie=function(o){if(null!=o){var e=o.name+"="+o.value;e+=";path="+o.path,e+=";expires="+o.expires,e+=";domain="+o.domain,document.cookie=e,this.data.cookie_set=o.value}},LogicHop.prototype.getCookie=function(o){if(this.data.cookie_set)return this.data.cookie_set;var e=document.cookie.match("(^|;) ?"+o+"=([^;]*)(;|$)");return e?e[2]:null},LogicHop.prototype.parseLogic=function(){var o=this;if(this.data.js_track&&this.data.anti_flicker&&(this.flicker_timeout=setTimeout(this.pageTimeout.bind(this),this.data.anti_flicker_timeout)),o.data.send=!!o.data.js_track,o.data.conditions=[],o.data.conditions_json=[],o.data.variables=[],o.data.referrer="referrer"in document?document.referrer:"",jQuery(".logichop-js").each(function(){var e=jQuery(this).attr("data-cid"),a=jQuery(this).attr("data-condition"),t=jQuery(this).attr("data-var");e&&(o.data.send=!0,-1==jQuery.inArray(e,o.data.conditions)&&o.data.conditions.push(e)),a&&(o.data.send=!0,-1==jQuery.inArray(a,o.data.conditions_json)&&o.data.conditions_json.push(a)),t&&o.data.js_vars&&(o.data.send=!0,-1==jQuery.inArray(t,o.data.variables)&&o.data.variables.push(t))}),o.data.send){var e=o.getQueryStrings();e.action="logichop_parse_logic",e.uncache=(new Date).valueOf(),e.data=o.data,e.logichop_cookie=o.getCookie(o.data.cookie_name),e.URL=window.location.pathname,e.payload=o.payload,jQuery.ajax({type:"POST",dataType:"json",url:o.data.ajaxurl,data:e,cache:!1,success:function(e){e.success&&(o.setCookie(e.cookie),o.data.loaded=!0,o.checkPageGoals(),e.redirect&&(window.location=e.redirect),e.conditions.length>0&&o.displayConditions(e.conditions),e.conditions_json.length>0&&o.displayConditionsJson(e.conditions_json),e.variables.length>0&&o.displayVariables(e.variables),void 0!==e.header_css&&""!=e.header_css&&jQuery("#logichop_header_css").append(e.header_css),void 0!==e.css&&""!=e.css&&jQuery("body").addClass(e.css),void 0!==e.css_preview&&(o.data.css_preview=e.css_preview),o.pageRendered())}})}else o.pageRendered()},LogicHop.prototype.displayConditions=function(o){for(var e=0;e<o.length;e++)jQuery('.logichop-js[data-cid="'+o[e].cid+'"]').each(function(){var a=jQuery(this),t=a.attr("data-not"),i=o[e].condition;if("true"===t&&(i=!i),i){var r=a.attr("data-event")?a.attr("data-event").toLowerCase():"";if(a.addClass(a.attr("data-css-add")).removeClass(a.attr("data-css-remove")),"hide"==r&&a.hide(),"show"==r&&a.show(),"toggle"==r&&a.toggle(),"slideup"==r&&a.slideUp(),"slidedown"==r&&a.slideDown(),"slidetoggle"==r&&a.slideToggle(),"fadein"==r&&a.fadeIn(),"fadeout"==r&&a.fadeOut(),"fadetoggle"==r&&a.fadeToggle(),"callback"==r){var c=window[a.attr("data-callback")];if("function"==typeof c){var s=[a];c.apply(null,s)}}jQuery(a).is(":visible")&&jQuery(a).addClass("logichop-visible")}})},LogicHop.prototype.displayConditionsJson=function(o){for(var e=0;e<o.length;e++)jQuery('.logichop-js[data-hash="'+o[e].hash+'"]').each(function(){var o=jQuery(this),e=o.attr("data-event")?o.attr("data-event").toLowerCase():"";e||o.show(),"show"==e&&o.show(),"hide"==e&&o.hide(),"toggle"==e&&o.toggle(),"slideup"==e&&o.slideUp(),"slidedown"==e&&o.slideDown(),"slidetoggle"==e&&o.slideToggle(),"fadein"==e&&o.fadeIn(),"fadeout"==e&&o.fadeOut(),"fadetoggle"==e&&o.fadeToggle(),jQuery(o).is(":visible")&&jQuery(o).addClass("logichop-visible")})},LogicHop.prototype.displayVariables=function(o){for(var e=0;e<o.length;e++)o[e].data_var&&void 0!==o[e].value&&jQuery('.logichop-js[data-var="'+o[e].data_var+'"]').each(function(){var a=jQuery(this),t=!!a.attr("data-type")&&a.attr("data-type").toLowerCase(),i=a.attr("data-event")?a.attr("data-event").toLowerCase():"",r=!!a.attr("data-case")&&a.attr("data-case").toLowerCase(),c=!!a.attr("data-spaces")&&a.attr("data-spaces").toLowerCase(),s=!!a.attr("data-prepend")&&a.attr("data-prepend"),l=!!a.attr("data-append")&&a.attr("data-append"),n=!!a.attr("data-default")&&a.attr("data-default");if(t||"A"!=a.get(0).tagName?t||"IMG"!=a.get(0).tagName?t||"INPUT"!=a.get(0).tagName?t||(t="replace"):t="value":t="src":t="href",null!=o[e].value||!1!==n){var d=o[e].value;if(null==d&&(d=n),r&&d&&(d=d.textf(r)),c&&(d=d.replace(/ /g,c)),"replace"!=t&&"html"!=t||a.html(d).addClass(a.attr("data-css-add")).removeClass(a.attr("data-css-remove")),"append"==t&&a.append(d).addClass(a.attr("data-css-add")).removeClass(a.attr("data-css-remove")),"prepend"==t&&a.prepend(d).addClass(a.attr("data-css-add")).removeClass(a.attr("data-css-remove")),"text"==t&&a.text(d).addClass(a.attr("data-css-add")).removeClass(a.attr("data-css-remove")),"value"==t&&a.val(d).addClass(a.attr("data-css-add")).removeClass(a.attr("data-css-remove")),"class"==t&&a.addClass(d),"src"==t){var p=a.attr("src");if(p){var u=p.replace(/#VAR#/,d);a.attr("src",u)}}if("href"==t){var g=a.attr("href");if(g){var h=g.replace(/#VAR#/,d);a.attr("href",h)}}s&&a.prepend(s),l&&a.append(l),"hide"==i&&a.hide(),"show"==i&&a.show(),"toggle"==i&&a.toggle(),"slideup"==i&&a.slideUp(),"slidedown"==i&&a.slideDown(),"slidetoggle"==i&&a.slideToggle(),"fadein"==i&&a.fadeIn(),"fadeout"==i&&a.fadeOut(),"fadetoggle"==i&&a.fadeToggle()}})},LogicHop.prototype.checkPageGoals=function(){var o=this;jQuery(".logichop-goal").each(function(){var e=jQuery(this).val(),a=!!jQuery(this).attr("data-condition")&&jQuery(this).attr("data-condition"),t=!!jQuery(this).attr("data-not"),i=!!jQuery(this).attr("data-delete");e&&o.updateGoal(e,a,t,i)})},LogicHop.prototype.enablePageGoals=function(){var o=this;function e(e){var a=jQuery(e.target).data("goal"),t=!!jQuery(this).attr("data-delete");a&&o.updateGoal(a,!1,!1,t)}jQuery(".logichop-click").on("click",e),jQuery(".logichop-dblclick").on("dblclick",e),jQuery(".logichop-mouseenter").on("mouseenter",e),jQuery(".logichop-mouseleave").on("mouseleave",e),jQuery(".logichop-keypress").on("keypress",e),jQuery(".logichop-keydown").on("keydown",e),jQuery(".logichop-keyup").on("keyup",e),jQuery(".logichop-submit").on("submit",e),jQuery(".logichop-change").on("change",e),jQuery(".logichop-focus").on("focus",e),jQuery(".logichop-blur").on("blur",e),jQuery(".logichop-load").on("load",e),jQuery(".logichop-resize").on("resize",e),jQuery(".logichop-scroll").on("scroll",e),jQuery(".logichop-unload").on("unload",e),void 0!==o.data.goal_ev&&void 0!==o.data.goal_el&&void 0!==o.data.goal_js&&jQuery(o.data.goal_el).on(o.data.goal_ev,function(){o.updateGoal(o.data.goal_js)})},LogicHop.prototype.getVariable=function(o){var e=this,a={action:"logichop_data",data_var:o=void 0!==o&&o,uncache:(new Date).valueOf(),logichop_cookie:e.getCookie(e.data.cookie_name)};return new Promise(function(o,t){jQuery.ajax({type:"POST",dataType:"json",url:e.data.ajaxurl,data:a,cache:!1,success:function(e){o(e)},error:function(){t(new Error("fail"))}})})},LogicHop.prototype.getVariables=function(){var o=this,e={action:"logichop_data_debug",uncache:(new Date).valueOf(),logichop_cookie:o.getCookie(o.data.cookie_name)};return new Promise(function(a,t){jQuery.ajax({type:"POST",dataType:"json",url:o.data.ajaxurl,data:e,cache:!1,success:function(o){a(o)},error:function(){t(new Error("fail"))}})})},LogicHop.prototype.checkCondition=function(o,e,a){e=void 0!==e?e:null,a=void 0!==a?a:null;var t={action:"logichop_condition",cid:o=void 0!==o&&o,uncache:(new Date).valueOf(),logichop_cookie:this.getCookie(this.data.cookie_name)};jQuery.ajax({type:"POST",dataType:"json",url:this.data.ajaxurl,data:t,cache:!1,success:function(t){t.success&&t.condition?null!==e&&e(o):null!==a&&a(o)},error:function(){null!==a&&a(o)}})},LogicHop.prototype.updateGoal=function(o,e,a,t){e=void 0!==e&&e,a=void 0!==a&&a,t=void 0!==t&&t;var i={action:"logichop_goal",goal:o,uncache:(new Date).valueOf(),logichop_cookie:this.getCookie(this.data.cookie_name)};e&&(i.condition=e),a&&(i.condition_not=!0),t&&(i.delete_goal=!0),jQuery.ajax({type:"POST",dataType:"json",url:this.data.ajaxurl,data:i,cache:!1,success:function(o){return!0}})},LogicHop.prototype.getQueryStrings=function(){for(var o,e=/\+/g,a=/([^&=]+)=?([^&]*)/g,t=function(o){return decodeURIComponent(o.replace(e," "))},i=window.location.search.substring(1),r={};o=a.exec(i);)r[t(o[1])]=t(o[2]);return r},LogicHop.prototype.logicBarSetup=function(){var o=this;document.querySelectorAll(".logichop-logic-bar").forEach(function(e,a,t){var i=e.getAttribute("data-hash"),r=e.getAttribute("data-delay");if("none"==r)o.logicBarPosition();else if("scroll"==r)window.onscroll=function(){o.logicBarDisplay(i)};else if("click"==r)document.addEventListener("click",function(e){o.logicBarDisplay(i)});else if("exit"==r)document.addEventListener("mouseout",function(e){null===e.toElement&&null===e.relatedTarget&&o.logicBarDisplay(i)});else{var c=parseInt(r);isNaN(c)||setTimeout(function(){o.logicBarDisplay(i)},c)}})},LogicHop.prototype.logicBarDisplay=function(o){var e=document.getElementById("bar-"+o),a=document.getElementById("block-"+o);e&&e.classList.contains("logic-bar-hide")&&(e.classList.remove("logic-bar-hide"),this.logicBarPosition(),a&&a.classList.remove("logic-bar-hide"))},LogicHop.prototype.logicBarPosition=function(){if(jQuery(".logichop-logic-bar").is(":visible")&&!jQuery(".logichop-logic-bar").hasClass("logichop-logic-bar-popup")){var o=parseInt(jQuery("html").css("margin-top")),e=jQuery(".logichop-logic-bar").outerHeight();jQuery("body").css("padding-top",e+"px"),jQuery(".logichop-logic-bar").css("top",o+"px")}},LogicHop.prototype.logicBarDismiss=function(){jQuery(".logichop-logic-bar").is(":visible")&&(jQuery("body").css("padding-top",0),jQuery(".logichop-logic-bar").hasClass("logichop-logic-bar-popup")?(jQuery(".logichop-logic-bar").hide(),jQuery(".logichop-logic-bar-screen-block").fadeOut()):jQuery(".logichop-logic-bar").slideUp())},LogicHop.prototype.pageRendered=function(){jQuery(".logichop-render-hide").removeClass("logichop-render-hide"),jQuery(".logichop-fade-in").fadeTo("fast",1),jQuery(".logichop-slide-down").slideDown(),this.flicker_timeout&&clearTimeout(this.flicker_timeout),this.logicBarSetup(),"function"==typeof logichop_page_rendered&&logichop_page_rendered()},LogicHop.prototype.pageTimeout=function(){jQuery(".logichop-render-hide").removeClass("logichop-render-hide"),jQuery(".logichop-fade-in").fadeTo("fast",1),jQuery(".logichop-slide-down").slideDown(),this.logicBarSetup(),"function"==typeof logichop_page_timeout&&logichop_page_timeout()},void 0!==logichop.pid){var logichop=new LogicHop(logichop);jQuery(document).ready(function(){logichop.parseLogic(),logichop.enablePageGoals(),jQuery(".logic-bar-close, .logic-bar-dismiss, .logichop-logic-bar-screen-block").click("click",function(o){logichop.logicBarDismiss(),o.preventDefault()})})}function logichop_var(o){return void 0!==logichop&&null!==logichop.data.vars&&void 0!==logichop.data.vars[o]?logichop.data.vars[o]:null}function logichop_var_promise(o){return void 0!==logichop?logichop.getVariable(o):null}function logichop_condition(o,e,a){o=void 0!==o&&o,e=void 0!==e?e:null,a=void 0!==a?a:null,void 0!==logichop&&o&&logichop.checkCondition(o,e,a)}function logichop_goal(o,e,a){e=void 0!==e&&e,a=void 0!==a&&a,void 0!==logichop&&logichop.updateGoal(o,e,a)}function logichop_goal_delete(o,e,a){e=void 0!==e&&e,a=void 0!==a&&a,void 0!==logichop&&logichop.updateGoal(o,e,a,!0)}function logichop_session_display(){void 0!==logichop&&logichop.getVariables().then(o=>console.log(o))}window.onresize=function(){void 0!==logichop&&logichop.logicBarPosition()},String.prototype.textf=function(o){return"lower"==o?this.toLowerCase():"upper"==o?this.toUpperCase():"words"==o?this.ucwords():"first"==o?this.capitalize():this},String.prototype.ucwords=function(){return this.toLowerCase().replace(/\b[a-z]/g,function(o){return o.toUpperCase()})},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};
