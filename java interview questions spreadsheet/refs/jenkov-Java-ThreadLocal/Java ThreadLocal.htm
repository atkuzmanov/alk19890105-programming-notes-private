<!DOCTYPE html>
<!-- saved from url=(0061)http://tutorials.jenkov.com/java-concurrency/threadlocal.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">
    <!--<meta name="viewport" content="width=device-width, height=device-height initial-scale=1.0, maximum-scale=1.0, user-scalable=0">-->
    <meta name="viewport" content="width=device-width, height=device-height initial-scale=1, user-scalable=1">

    <title>Java ThreadLocal</title>

    <meta name="description" content="The Java ThreadLocal class can be used to create variables which values can  only be read by thread that set that value. Thus, the Java ThreadLocal class offers an easy way to make code thread safe which is otherwise not thread safe.">
    <meta name="keywords" content="java threadlocal">
    <meta name="author" content="Jakob Jenkov">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@jjenkov">
    <meta name="twitter:title" content="Java ThreadLocal">
    <meta name="twitter:description" content="The Java ThreadLocal class can be used to create variables which values can  only be read by thread that set that value. Thus, the Java ThreadLocal class offers an easy way to make code thread safe which is otherwise not thread safe.">
    <meta name="twitter:creator" content="@jjenkov">
    <meta name="twitter:domain" content="jenkov.com">

    <meta name="twitter:image:src" content="http://tutorials.jenkov.com/images/java-concurrency/java-concurrency-teaser-500-300.png">

    <meta name="og:type" content="article">
    <meta name="og:title" content="Java ThreadLocal">
    <meta property="og:url" content="http://tutorials.jenkov.com/java-concurrency/threadlocal.html">
    <meta property="og:description" content="The Java ThreadLocal class can be used to create variables which values can  only be read by thread that set that value. Thus, the Java ThreadLocal class offers an easy way to make code thread safe which is otherwise not thread safe.">

    <meta property="og:image" content="http://tutorials.jenkov.com/images/java-concurrency/java-concurrency-teaser-500-300.png">

    <link href="https://plus.google.com/108227213807945109821" rel="publisher">

    <meta name="google-site-verification" content="i_TwzdElg-by5uXLvyAjuIaCjxo0yjtW8LdRPUDEEcw">
<script charset="utf-8" src="./Java ThreadLocal_files/button.a657e8de41cd5e7b38cde1f36c9ab9c2.js"></script></head>

<body>

<style>
body {background-color: #f0f0f0; xbackground-image: linear-gradient(180deg, #f0f0f0, #e0e0e0); margin: 0px; font-family: arial;}

.grid {
  display: grid;

}
.topBar, .footer {
  grid-column-start: 1;
  grid-column-end: 12;
  background-color: #000000;
  color: #ffffff;
  height: 64px;
  box-shadow: 0px 8px 6px -6px #999999;
}

.content {
  grid-column-start: 1;
  grid-column-end: 12;
  text-align: center;
}
.category, .main, .right {
	display: inline-block;
    vertical-align: top;
	box-sizing: border-box;
	text-align: left;
}
.footer {
  height: 64px;
  position: relative;
  padding-bottom: 48px;
}
#footerCopyright {
	position: absolute;
	top: 20px;
	left:20px;
}

.card{ background-color: #ffffff; box-shadow: 0px 8px 6px -6px #999999;padding: 20px 30px;border: 1px solid #e0e0e0; margin: 8px 4px;}
.cardLeft  { margin-left:   8px; }
.cardRight { margin-right:  8px; }
.cardTop   { margin-top:    8px; }
.cardBottom{ margin-bottom: 8px; }

#topBarMenu    { position: absolute; top: 20px; left: 20px; }
#topBarMenu a  { color: #ffffff; text-decoration: none; }
#topBarLogoBox { text-align: right; padding-top:6px; margin-right: 16px;}
#topBarLogo    { height: 38px; }
#topBarPhrase  { padding-right: 4px; font-size: 0.8em; }
</style>

<style>
a{ text-decoration:none; }
#main, #mainBody { text-align: left; }

#mainBody h1{margin-top: 0px; text-align:left; }
#mainBody h2{margin: 24px 0px 0px 0px; text-align:left; }
#mainBody a{font-weight: bold; color: #339;}
#mainBody img{max-width:100%;}
#mainBody svg{max-width:100%;overflow: auto;}

.card{ background-color: #ffffff; box-shadow: 0px 8px 6px -6px #999999;padding: 20px 30px;border: 1px solid #e0e0e0;}
#trailToc ol li{border-bottom: 1px solid #f0f0f0;padding: 4px 20px;vertical-align: top;}
.codeBox {background-color: #f0f0f0;border: 1px solid #cccccc;padding: 10px;max-width: 100%;overflow: auto;}
code{font-size: 1.2em;}
.dataTable{background-color: #f0f0f0;border: 1px solid #cccccc;max-width: 100%;overflow: auto;}
.dataTable th{text-align: left;}
.dataTable th, .dataTable td{padding: 2px 8px; }
#pageToc{border: 1px solid #f0f0f0; text-align:left; }
#pageToc li{margin: 6px 0px;}
#pageToc a{color: #339;font-weight: normal;}
#lastUpdate{border: 1px solid #f0f0f0;border-top:none;padding: 6px 24px;font-size: 0.8em;color: #666; text-align:left; }
#next{border-top: 1px solid #f0f0f0;padding: 10px 0px;font-size: 1.1em;}
#bottomSocial{border-top: 1px solid #f0f0f0;padding: 10px 0px;font-size: 0.9em;}
</style>


<style>
@media only screen and (max-width: 799px) {
	.main     { width: 100%;}
	.category { display: none; }
	.right    {	display: none; }
	.card     { padding: 10px 8px; }
    .bigScreen{ display: none; }
}
@media only screen and (min-width: 800px) and (max-width: 1199px) {
	.main     { width: 75%; }
	.category {	width: 25%;	}
	.right    { display:none;}
	.smallScreen { display: none; }
}
@media only screen and (min-width: 1200px) {
	.main     { width: 50%;	max-width: 900px; }
	.category { width: 25%;	max-width: 300px; }
	.right    { width: 25%; max-width: 400px; display:none;}
	.smallScreen { display: none; }
}

@media only screen and (max-width: 600px) {
  #topBarLogo{transform: scale(0.75, 0.75) translate(0px, 0px);}
}
@media only screen and (max-width: 480px) {
  #topBarLogo{transform: scale(0.6, 0.6) translate(136px, 0px);}
  #topBarMenu a{ font-size: 0.8em; }
  h1{ font-size: 1.6em; }
  h2{ font-size: 1.4em; }
  h3{ font-size: 1.2em; }
}
</style>

<div class="grid">

    <div class="topBar">

        <div id="topBarMenu">
            <a href="http://tutorials.jenkov.com/" title="Tutorials">Tutorials</a>
            &nbsp;&nbsp;&nbsp;
            <a href="http://jenkov.com/about/index.html" title="Tutorials">About</a>
            &nbsp;&nbsp;&nbsp;
            <a href="http://jenkov.com/rss.xml" title="RSS">RSS</a>
        </div>

        <div id="topBarLogoBox">
            <div id="topBarLogo"><svg x="0px" y="0px" width="409px" height="48px" viewBox="0 0 409 100" style="enable-background:new 0 0 409 100;" xml:space="preserve">  <path d="M53,32 l10,0  l0,26  c-7,21 -30,21 -53,10  l4,-9  c18,11 33,10 39,-3  z " style="stroke: none; stroke-width: 1; fill: #ffffff;"></path>  <path d="M69,32 l50,0  l0,9  l-50,0 z" style="stroke: none; stroke-width: 1; fill: #ffffff;"></path>  <path d="M69,49 l50,0  l0,9  l-50,0 z" style="stroke: none; stroke-width: 1; fill: #ffffff;"></path>  <path d="M69,65 l50,0  l0,9  l-50,0 z" style="stroke: none; stroke-width: 1; fill: #ffffff;"></path>  <path d="M126,32 l13,0  l40,31  l0,-31  l10,0  l0,42  l-10,0 l-43,-32 l0,32 l-10,0 z " style="stroke: none; stroke-width: 1; fill: #ffffff;"></path>  <path d="M179,32  l10,0  l0,15 l5,0  l32.5,-14.5  l19,0  l-41,19  l40,22  l-19,0  l-33,-18  l-3.5,0  l0,19  l-10,0 z " style="stroke: none; stroke-width: 1; fill: #ffffff;"></path>  <path d="M238,49  c10,-24 60,-24 70,0  l-11,0  c-10,-12 -38,-12 -48,0  z " style="stroke: none; stroke-width: 1; fill: #ffffff;"></path>  <path d="M238,57  c10,24 60,24 70,0  l-11,0  c-10,12 -38,12 -48,0  z " style="stroke: none; stroke-width: 1; fill: #ffffff;"></path>  <path d="M304,32  l13,0  l25,34 l25,-34  l13,0  l-32,42 l-12.5,0 z" style="stroke: none; stroke-width: 1; fill: #ffffff;"></path>  <path d="M369,65  l12,0 l0,8 l-12,0 z" style="stroke: none; stroke-width: 1; fill: #ffffff;"></path>  <path d="M390,53  c3,-27 54,-27 67,-10  l-15,0  c-10,-5 -40,-5 -41.5,10 l-10,0  " style="stroke: none;  stroke-width: 1; fill: #ffffff;"></path>  <path d="M390,53  c3,27 54,27 67,10  l-15,0  c-10,5 -40,5 -41.5,-10 l-10,0  " style="stroke: none;  stroke-width: 1; fill: #ffffff;"></path>  <path d="M460,49  c10,-24 60,-24 70,0  l-11,0  c-10,-12 -38,-12 -48,0  z " style="stroke: none; stroke-width: 1; fill: #ffffff;"></path>  <path d="M460,57  c10,24 60,24 70,0  l-11,0  c-10,12 -38,12 -48,0  z " style="stroke: none; stroke-width: 1; fill: #ffffff;"></path>  <path d="M534,34  l10,0  l0,6 c13,-10 26,-10 37,0  c12,-10 32,-10 39,3  l0,30  l-10,0  l0,-27  c-3,-9 -24,-9 -28,3 l0,24  -10,0  l0,-27  c-3,-9 -24,-9 -28,3 l0,24  -10,0 z" style="stroke: none; stroke-width: 1; fill: #ffffff;"></path></svg></div>
            <div id="topBarPhrase">Tech and Media Labs</div>
        </div>

    </div>


    <div class="content">
        <div class="site-menu">

            <!--
              <div class="card cardLeft cardTop">Software Development
                <ul>
                  <li>Java &amp; JVM</li>
                  <li>Web</li>
                  <li>Distributed Systems</li>
                </ul>
            </div>
            -->
        </div><div class="category">
        <div id="trailToc" class="card cardTop cardBottom">
            <div id="trailTitle">Java Concurrency</div><ol><li><a href="http://tutorials.jenkov.com/java-concurrency/index.html">Java Concurrency and Multithreading Tutorial</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/benefits.html">Multithreading Benefits</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/costs.html">Multithreading Costs</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/concurrency-models.html">Concurrency Models</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/same-threading.html">Same-threading</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/concurrency-vs-parallelism.html">Concurrency vs. Parallelism</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/creating-and-starting-threads.html">Creating and Starting Java Threads</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/race-conditions-and-critical-sections.html">Race Conditions and Critical Sections</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/thread-safety.html">Thread Safety and Shared Resources</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/thread-safety-and-immutability.html">Thread Safety and Immutability</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/java-memory-model.html">Java Memory Model</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/synchronized.html">Java Synchronized Blocks</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/volatile.html">Java Volatile Keyword</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/threadlocal.html"><b>Java ThreadLocal</b></a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/thread-signaling.html">Thread Signaling</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/deadlock.html">Deadlock</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/deadlock-prevention.html">Deadlock Prevention</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/starvation-and-fairness.html">Starvation and Fairness</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/nested-monitor-lockout.html">Nested Monitor Lockout</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/slipped-conditions.html">Slipped Conditions</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/locks.html">Locks in Java</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/read-write-locks.html">Read / Write Locks in Java</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/reentrance-lockout.html">Reentrance Lockout</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/semaphores.html">Semaphores</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/blocking-queues.html">Blocking Queues</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/thread-pools.html">Thread Pools</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/compare-and-swap.html">Compare and Swap</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/anatomy-of-a-synchronizer.html">Anatomy of a Synchronizer</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/non-blocking-algorithms.html">Non-blocking Algorithms</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/amdahls-law.html">Amdahl's Law</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/references.html">Java Concurrency References</a></li></ol>
        </div>
    </div><div class="main">
        <div class="card cardTop cardBottom">
            <h1 style="text-align: left;">Java ThreadLocal</h1>

            <div id="pageToc" itemscope="" itemtype="http://schema.org/SiteNavigationElement">
                <ul><li><a href="http://tutorials.jenkov.com/java-concurrency/threadlocal.html#creating-a-threadlocal">Creating a ThreadLocal</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/threadlocal.html#set-threadlocal-value">Set ThreadLocal Value</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/threadlocal.html#get-threadlocal-value">Get ThreadLocal Value</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/threadlocal.html#remove-threadlocal-value">Remove ThreadLocal Value</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/threadlocal.html#generic-threadlocal">Generic ThreadLocal</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/threadlocal.html#initial-threadlocal-value">Initial ThreadLocal Value</a><ul><li><a href="http://tutorials.jenkov.com/java-concurrency/threadlocal.html#override-initialvalue">Override initialValue()</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/threadlocal.html#provide-a-supplier-implementation">Provide a Supplier Implementation</a></li></ul></li><li><a href="http://tutorials.jenkov.com/java-concurrency/threadlocal.html#lazy-setting-of-threadlocal-value">Lazy Setting of ThreadLocal Value</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/threadlocal.html#using-a-threadlocal-with-a-thread-pool-or-executorservice">Using a ThreadLocal with a Thread Pool or ExecutorService</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/threadlocal.html#full-threadlocal-example">Full ThreadLocal Example</a></li><li><a href="http://tutorials.jenkov.com/java-concurrency/threadlocal.html#inheritableThreadLocal">InheritableThreadLocal</a></li></ul>
            </div>
            <div id="lastUpdate">
                <table><tbody><tr><td class="authorPhoto"></td>
                    <td><p style="margin: 0px 0px 6px 0px;">
                        Jakob Jenkov<br>
                        Last update: 2019-11-13
                    </p>
                        <div class="authorSocialLinks"></div>
                    </td>
                </tr>
                </tbody></table>
            </div>

            <div id="mainBody">
                <p>
    The <em>Java</em> <em>ThreadLocal</em> class enables you to create variables that can only be read and written by
    the same thread. Thus, even if two threads are executing the same code, and the code has a reference to the same
    <code>ThreadLocal</code> variable, the two threads cannot see each other's <code>ThreadLocal</code> variables.
    Thus, the Java ThreadLocal class provides a simple way to make code
    <a href="http://tutorials.jenkov.com/java-concurrency/thread-safety.html">thread safe</a> that would not otherwise be so.
</p>




<a name="creating-a-threadlocal"></a>
<h2>Creating a ThreadLocal</h2>
<p>
    You create a <code>ThreadLocal</code> instance just like you create any other Java object - via the <code>new</code>
    operator. Here is an example that shows how to create a <code>ThreadLocal</code> variable:
</p>

<pre class="codeBox">private ThreadLocal threadLocal = new ThreadLocal();
</pre>

<p>
    This only needs to be done once per thread. Multiple threads can now get and set values inside this
    <code>ThreadLocal</code>, and each thread will only see the value it set itself.
</p>



<a name="set-threadlocal-value"></a>
<h2>Set ThreadLocal Value</h2>

<p>
    Once a <code>ThreadLocal</code> has been created you can set the value to be stored in it using its
    <code>set()</code> method.
</p>

<pre class="codeBox">threadLocal.set("A thread local value");
</pre>



<a name="get-threadlocal-value"></a>
<h2>Get ThreadLocal Value</h2>

<p>
    You read the value stored in a <code>ThreadLocal</code> using its <code>get()</code> method. Here is an example
    obtaining the value stored inside a Java <code>ThreadLocal</code>:
</p>

<pre class="codeBox">String threadLocalValue = (String) threadLocal.get();
</pre>



<a name="remove-threadlocal-value"></a>
<h2>Remove ThreadLocal Value</h2>

<p>
    It is possible to remove a value set in a ThreadLocal variable. You remove a value by calling the
    <code>ThreadLocal</code> <code>remove()</code> method. Here is an example of removing the value set on a
    Java <code>ThreadLocal</code>:
</p>

<pre class="codeBox">threadLocal.remove();
</pre>




<a name="generic-threadlocal"></a>
<h2>Generic ThreadLocal</h2>

<p>
    You can create a <code>ThreadLocal</code> with a generic type. Using a generic type only objects of the generic type
    can be set as value on the <code>ThreadLocal</code>. Additionally, you do not have to typecast the value returned by
    <code>get()</code>. Here is a generic <code>ThreadLocal</code> example:
</p>

<pre class="codeBox">private ThreadLocal&lt;String&gt; myThreadLocal = new ThreadLocal&lt;String&gt;();
</pre>

<p>
    Now you can only store strings in the <code>ThreadLocal</code> instance. Additionally, you do not need to typecast
    the value obtained from the <code>ThreadLocal</code>:
</p>

<pre class="codeBox">myThreadLocal.set("Hello ThreadLocal");

String threadLocalValue = myThreadLocal.get();
</pre>




<a name="initial-threadlocal-value"></a>
<h2>Initial ThreadLocal Value</h2>

<p>
    It is possible to set an initial value for a Java <code>ThreadLocal</code> which will get used the first time
    <code>get()</code> is called - before <code>set()</code> has been called with a new value. You have two options
    for specifying an initial value for a ThreadLocal:
</p>

<ul>
    <li>Create a ThreadLocal subclass that overrides the <code>initialValue()</code> method.</li>
    <li>Create a ThreadLocal with a <code>Supplier</code> interface implementation.</li>
</ul>

<p>
    I will show you both options in the following sections.
</p>



<a name="override-initialvalue"></a>
<h3>Override initialValue()</h3>
<p>
    The first way to specify an initial value for a Java <code>ThreadLocal</code> variable is to create a subclass
    of <code>ThreadLocal</code> which overrides its <code>initialValue()</code> method. The easiest way to create
    a subclass of <code>ThreadLocal</code> is to simply create an anonymous subclass, right where you create the
    <code>ThreadLocal</code> variable. Here is an example of creating an anonymous subclass of <code>ThreadLocal</code>
    which overrides the <code>initialValue()</code> method:
</p>

<pre class="codeBox">private ThreadLocal myThreadLocal = new ThreadLocal&lt;String&gt;() {
    @Override protected String initialValue() {
        return String.valueOf(System.currentTimeMillis());
    }
};    
</pre>

<p>
    Note, that different threads will still see different initial values. Each thread will create its own initial value.
    Only if you return the exact same object from the <code>initialValue()</code> method, will all threads see the
    same object. However, the whole point of using a <code>ThreadLocal</code> in the first place is to avoid the
    different threads seeing the same instance.
</p>



<a name="provide-a-supplier-implementation"></a>
<h3>Provide a Supplier Implementation</h3>

<p>
    The second method for specifying an initial value for a Java <code>ThreadLocal</code> variable is to 
    use its static factory method <code>withInitial(Supplier)</code> passing a <code>Supplier</code> interface
    implementation as parameter. This <code>Supplier</code> implementation supplies the initial value for the
    <code>ThreadLocal</code>. Here is an example of creating a <code>ThreadLocal</code> using its 
    <code>withInitial()</code> static factory method, passing a simple <code>Supplier</code> implementation as
    parameter:
</p>


<pre class="codeBox">ThreadLocal&lt;String&gt; threadLocal = ThreadLocal.withInitial(new Supplier&lt;String&gt;() {
    @Override
    public String get() {
        return String.valueOf(System.currentTimeMillis());
    }
});
</pre>

<p>
    Since <code>Supplier</code> is a
    <a href="http://tutorials.jenkov.com/java-functional-programming/functional-interfaces.html">functional interface</a>,
    it an be implemented using a <a href="http://tutorials.jenkov.com/java/lambda-expressions.html">Java Lambda Expression</a>.
    Here is how providing a <code>Supplier</code> implementation as a lambda expression to <code>withInitial()</code>
    looks:
</p>

<pre class="codeBox">ThreadLocal threadLocal = ThreadLocal.withInitial(
        () -&gt; { return String.valueOf(System.currentTimeMillis()); } );
</pre>

<p>
    As you can see, this is somewhat shorter than the previous example. But it can be made even a bit shorter yet,
    using the most dense syntax of lambda expressions:
</p>

<pre class="codeBox">ThreadLocal threadLocal3 = ThreadLocal.withInitial(
        () -&gt; String.valueOf(System.currentTimeMillis()) );
</pre>



<a name="lazy-setting-of-threadlocal-value"></a>
<h2>Lazy Setting of ThreadLocal Value</h2>

<p>
    In some situations you cannot use the standard ways of setting an initial value. For instance, perhaps you need
    some configuration information which is not available at the time you create the ThreadLocal variable. In that
    case you can set the initial value lazily. Here is an example of how setting an initial value lazily on a
    Java ThreadLocal:
</p>

<pre class="codeBox">public class MyDateFormatter {

    private ThreadLocal&lt;SimpleDateFormat&gt; simpleDateFormatThreadLocal = new ThreadLocal&lt;&gt;();

    public String format(Date date) {
        SimpleDateFormat simpleDateFormat = getThreadLocalSimpleDateFormat();
        return simpleDateFormat.format(date);
    }
    
    
    private SimpleDateFormat getThreadLocalSimpleDateFormat() {
        SimpleDateFormat simpleDateFormat = simpleDateFormatThreadLocal.get();
        if(simpleDateFormat == null) {
            simpleDateFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
            simpleDateFormatThreadLocal.set(simpleDateFormat);
        }
        return simpleDateFormat;
    }
}
</pre>

<p>
    Notice how the <code>format()</code> method calls the <code>getThreadLocalSimpleDateFormat()</code> method
    to obtain a <a href="http://tutorials.jenkov.com/java-internationalization/simpledateformat.html">Java SimpleDatFormat</a>
    instance. If a <code>SimpleDateFormat</code> instance has not been set in the <code>ThreadLocal</code>, a new
    <code>SimpleDateFormat</code> is created and set in the <code>ThreadLocal</code> variable. Once a thread has set
    its own <code>SimpleDateFormat</code> in the <code>ThreadLocal</code> variable, the same <code>SimpleDateFormat</code>
    object is used for that thread going forward. But only for that thread. Each thread creates its own <code>SimpleDateFormat</code>
    instance, as they cannot see each others instances set on the <code>ThreadLocal</code> variable.
</p>

<p>
    The <code>SimpleDateFormat</code> class is not thread safe, so multiple threads cannot use it at the
    same time. To solve this problem, the <code>MyDateFormatter</code> class above creates a <code>SimpleDateFormat</code>
    per thread, so each thread calling the <code>format()</code> method will use its own <code>SimpleDateFormat</code>
    instance.
</p>




<a name="using-a-threadlocal-with-a-thread-pool-or-executorservice"></a>
<h2>Using a ThreadLocal with a Thread Pool or ExecutorService</h2>

<p>
    If you plan to use a Java <code>ThreadLocal</code> from inside a task passed to a
    <a href="http://tutorials.jenkov.com/java-concurrency/thread-pools.html">Java Thread Pool</a> or a
    <a href="http://tutorials.jenkov.com/java-util-concurrent/executorservice.html">Java ExecutorService</a>, keep in
    mind that you do not have any guarantees which thread will execute your task. However, if all you need is to
    make sure that each thread uses its own instance of some object, this is not a problem. Then you can use a
    Java ThreadLocal with a thread pool or <code>ExecutorService</code> just fine.
</p>




<a name="full-threadlocal-example"></a>
<h2>Full ThreadLocal Example</h2>

<p>
    Here is a fully runnable Java <code>ThreadLocal</code> example:
</p>

<pre class="codeBox">public class ThreadLocalExample {

    public static void main(String[] args) {
        MyRunnable sharedRunnableInstance = new MyRunnable();

        Thread thread1 = new Thread(sharedRunnableInstance);
        Thread thread2 = new Thread(sharedRunnableInstance);

        thread1.start();
        thread2.start();

        thread1.join(); //wait for thread 1 to terminate
        thread2.join(); //wait for thread 2 to terminate
    }

}
</pre>

<pre class="codeBox">public class MyRunnable implements Runnable {

    private ThreadLocal&lt;Integer&gt; threadLocal = new ThreadLocal&lt;Integer&gt;();

    @Override
    public void run() {
        threadLocal.set( (int) (Math.random() * 100D) );

        try {
            Thread.sleep(2000);
        } catch (InterruptedException e) {
        }

        System.out.println(threadLocal.get());
    }
}
</pre>


<p>
    This example creates a single <code>MyRunnable</code> instance which is passed to two different threads.
    Both threads execute the <code>run()</code> method, and thus sets different values on the <code>ThreadLocal</code>
    instance. If the access to the <code>set()</code> call had been synchronized, and it had <i>not</i> been a
    <code>ThreadLocal</code> object, the second thread would have overridden the value set by the first thread.
</p>

<p>
    However, since it <i>is</i> a <code>ThreadLocal</code> object then the two threads cannot see each other's values.
    Thus, they set and get different values.
</p>




<a name="inheritableThreadLocal"></a>
<h2>InheritableThreadLocal</h2>

<p>
    The <code>InheritableThreadLocal</code> class is a subclass of <code>ThreadLocal</code>. Instead of each thread
    having its own value inside a <code>ThreadLocal</code>, the <code>InheritableThreadLocal</code> grants access
    to values to a thread and all child threads created by that thread.
</p>
            </div>

            <div id="next">Next: <a href="http://tutorials.jenkov.com/java-concurrency/thread-signaling.html">Thread Signaling</a></div>
            <div id="bottomSocial">

                <div style="display:inline-block;">
                    <table>
                        <tbody><tr><td colspan="2">
                            <div id="___plus_0" style="position: absolute; width: 450px; left: -10000px;"><iframe ng-non-bindable="" frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="position:absolute;top:-10000px;width:450px;margin:0px;border-style:none" tabindex="0" vspace="0" width="100%" id="I0_1581179672758" name="I0_1581179672758" src="./Java ThreadLocal_files/sharebutton.html" data-gapiattached="true"></iframe></div><div class="g-plus" data-action="share" data-height="24" data-annotation="none" data-gapiscan="true" data-onload="true" data-gapistub="true"></div>
                            <script src="./Java ThreadLocal_files/cb=gapi.loaded_1" async=""></script><script src="./Java ThreadLocal_files/cb=gapi.loaded_0" async=""></script><script async="" src="./Java ThreadLocal_files/analytics.js"></script><script id="twitter-wjs" src="./Java ThreadLocal_files/widgets.js"></script><script type="text/javascript" async="" src="./Java ThreadLocal_files/platform.js" gapi_processed="true"></script><script type="text/javascript">
                                (function() {
                                    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                                    po.src = 'https://apis.google.com/js/platform.js';
                                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
                                 })();
                            </script>

                            <iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" class="twitter-share-button twitter-share-button-rendered twitter-tweet-button" style="position: static; visibility: visible; width: 61px; height: 20px;" title="Twitter Tweet Button" src="./Java ThreadLocal_files/tweet_button.7303c29a8108bca4ac5c9ef008ed8164.en.html"></iframe>
                            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

                        </td></tr>
                        <tr><td class="authorPhoto"></td><td><p style="margin: 0px 0px 6px 0px;">Jakob Jenkov</p><div class="authorSocialLinks"></div></td></tr>
                    </tbody></table>
                </div>

                <div style="display: none;" class="newsletterForm"></div>

            </div>

        </div>
    </div><div class="right">
        <div class="card cardRight cardTop cardBottom">Right 1
            <div>Right 2</div>
        </div>
    </div>
    </div>
    <div class="footer">
        <div id="footerCopyright">Copyright Jenkov Aps</div>
    </div>
</div>

<style>
.navButton{color: #ffffff; font-weight: bold;}
#trailTocFixedDiv{position: fixed;  top : 0px; left : 0px; width : 100%; height : 100%;  display : none; background-color: #ffffff;}
#trailTocFixedInnerDiv{width: 400px; max-width: 94%; height: calc(100% - 72px); overflow : auto; margin: 20px auto 20px auto; padding: 0px 0px 180px 0px;}
#trailTocFixedInnerDiv th{border-bottom: 1px solid #f0f0f0;padding: 6px 10px;text-align: left;font-size: 1.2em;}
#trailTocFixedInnerDiv td{border-bottom: 1px solid #f0f0f0;padding: 6px 20px;vertical-align: top;}
#trailTocFixedCloseButton{width : 72px; padding: 10px 20px; background-color: #009900; border: 2px solid #006600; color: #ffffff; font-size: 0.8em; font-weight: bold; position: absolute; right: 0px; cursor: pointer; box-shadow: 2px 2px 2px 2px #cccccc;}
#bottomNavBarDiv{position:fixed; bottom: 0px; width: 100%;  background-color: #202020; border-top: 1px solid #444444;}
.buttonNavBarButtonDivActive{background-color: #404040;}
#bottomNavBarRow>div{border-left: 1px solid #404040; border-right: 1px solid #000000;  height: 48px;  padding-top:16px; text-align: center; cursor: pointer;}
#bottomNavBarDiv a{color: #ffffff; font-weight: bold;}
#bottomNavBarDiv br{display:none;}
#bottomNavBarDiv img{ height: 20px; }
#nextButton2{ display:none; }
@media only screen and (max-width: 700px){
  #bottomNavBarDiv, #bottomNavBarDiv [jqc-cell] { height: 58px; }
  #bottomNavBarDiv [jqc-cell] {padding-top: 12px;}
  #bottomNavBarDiv a { font-size: 0.8em; }
  #bottomNavBarDiv br { display: inline; }
  #nextButton1 { display: none; }
  #nextButton2 { display: inline; }
}
@media only screen and (max-width: 400px){
  #bottomNavBarDiv [jqc-cell] {padding-top: 10px;}
  #bottomNavBarDiv a {font-size: 0.5em;}
  #bottomNavBarDiv img {height: 24px;}
}
</style>


<div id="trailTocFixedDiv">
    <div id="trailTocFixedCloseButton">Close TOC</div>
    <div id="trailTocFixedInnerDiv"></div>
</div>

<style>
#bottomNavBar2Parent{position:fixed; bottom: 0px; width: 100%;  background-color: #202020; border-top: 1px solid #444444;}
#bottomNavBar2>div{border-left: 1px solid #404040; border-right: 1px solid #000000;  height: 48px;  padding-top:16px; text-align: center; cursor: pointer;}


#bottomNavBar2{
  display: grid;
}
#allTrailsButtonDiv2{
  grid-column-start: 1;
  grid-column-end: 3;
}

#trailTocButtonDiv2 {
  grid-column-start: 3;
  grid-column-end: 5;
}

#pageTocButtonDiv2{
  grid-column-start: 5;
  grid-column-end: 7;
}

#prevButtonDiv2 {
  grid-column-start: 7;
  grid-column-end: 9;
}

#nextButtonDiv2 {
  grid-column-start: 9;
  grid-column-end: 13;
}

</style>

<div id="bottomNavBar2Parent">
<div id="bottomNavBar2">

    <div id="allTrailsButtonDiv2">
        <span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAbUlEQVRIx+3SQQrAIAxEUenNewrvmkXUQgVJEwWdQEED4kb+QzSEPw0z389yi6d3JJKaWY5ryBKgxSVS9jgF9OItQkRXRaBxDYHHJeISt34XND5EEHETQcY/iEfcvAkqbD7yAaYB1PkD7AB4TAY0StbUr69awQAAAABJRU5ErkJggg=="></span> <br>
        <span class="navButton" style="position:relative; top:-4px;">All Trails</span>
    </div>

    <div id="trailTocButtonDiv2">
        <span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAPElEQVRIx2P4TwPAgAzoZgEDrQDdLaB6cI1aMHgtoFriGRkWEB3eg9YHo0E08BaM8CAiWoLaFlAL0NwCANELs4XjmhvVAAAAAElFTkSuQmCC"></span> <br>
        <span class="navButton" style="position:relative; top:-4px;">Trail TOC</span>
    </div>

    <div id="pageTocButtonDiv2">
        <span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAANUlEQVRIx2NggIL/VAYM6GDUglELqGcBA4Vg1ALqWkBOhA4uH4wG0cBbMBpEw9QCagG6WQAAX980BcIgiscAAAAASUVORK5CYII="></span> <br>
        <span class="navButton" style="position:relative; top:-4px;">Page TOC</span>
    </div>

    <div id="prevButtonDiv2">
        <span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuNvyMY98AAACCSURBVEhL3ZRRCsAgDEM9iez+dxJPUl0K9W+MtKMiC/RL80Lz0eKViNQxRpsvwnvHv8ssvGD8ORzjh7Odf4F34zxK30O1qImEV7Pw0nUJeEuFY/xwspZceKiWVLgqPUC1JQSAc0Iwh2+iZiIkdiqWdobknOslmM8JwcbxELaujSGl3GNH6mWcCMu2AAAAAElFTkSuQmCC"></span> <br>
        <span class="navButton" style="position:relative; top:-4px;">Previous</span>
    </div>

    <div id="nextButtonDiv2">
        <!--<span class="navButton" id="nextButton1_2" style="position:relative; top:-4px;">Next</span>-->
        <span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAb0lEQVRIx82W2w1AIQhDmcS4/07GScDbu4AvUlMSv9QeA6RohnD3GhF9TAL7DeeK3cYuBEscgss6kBc16VlI2YTULKStIH9aMzXRgTxJlzaECpAQv+okaptSX35gFed+RBWn2jV14FBHJvVnwRT/AGJL6mWb6M7pAAAAAElFTkSuQmCC"></span> <br>
        <span class="navButton" id="nextButton2_2" style="position:relative; top:-4px;">Next</span>
    </div>

</div>
</div>


<script>
var prevArticleInCategory = "/java-concurrency/volatile.html";
var nextArticleInCategory = "/java-concurrency/thread-signaling.html";
</script>


<script>
function qid(id) { return document.getElementById(id); }
</script>

<!-- Nav bar code -->
<script>
function toggle(el){
    if(el.isShown == null || el.isShown == false) {
        el.isShown = true;
        el.style.display = "block";
    } else {
        el.isShown = false;
        el.style.display = "none";
    }
}

qid("allTrailsButtonDiv2").addEventListener("mouseup", function(e) {
    location.href="/";
    e.preventDefault();
    e.stopPropagation();
});
qid("trailTocButtonDiv2").addEventListener("mouseup", function(e) {
    var tocHtml = qid("trailToc").innerHTML;
    qid("trailTocFixedInnerDiv").innerHTML = tocHtml + "<br><br><br><br><br><br><br><br><br><br>";
    toggle(qid("trailTocFixedDiv"));
    e.preventDefault();
    e.stopPropagation();
});
qid("trailTocFixedCloseButton").addEventListener("mouseup", function(e) {
    toggle(qid("trailTocFixedDiv"));
    e.preventDefault();
    e.stopPropagation();
});
qid("pageTocButtonDiv2").addEventListener("mouseup", function(e) {
    location.href="#pageToc";
    e.preventDefault();
    e.stopPropagation();
});
qid("prevButtonDiv2").addEventListener("mouseup", function(e) {
    if(prevArticleInCategory != "") {
        location.href = prevArticleInCategory;
    } else {
        alert("This is the first article in this trail");
    }
});
qid("nextButtonDiv2").addEventListener("mouseup", function(e) {
  if(nextArticleInCategory != "") {
    location.href= nextArticleInCategory;
  } else {
    alert("This is the last article in this trail.");
  }
  e.preventDefault();
  e.stopPropagation();
});
</script>


<!-- Google Analytics Script -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-4036229-3', 'auto');
  ga('send', 'pageview');
</script>

<!-- Google Adsense Script -->
<script data-ad-client="ca-pub-5569543489255665" async="" src="./Java ThreadLocal_files/f.txt"></script>





<iframe scrolling="no" frameborder="0" allowtransparency="true" src="./Java ThreadLocal_files/widget_iframe.7303c29a8108bca4ac5c9ef008ed8164.html" title="Twitter settings iframe" style="display: none;"></iframe><iframe name="oauth2relay1375255268" id="oauth2relay1375255268" src="./Java ThreadLocal_files/postmessageRelay.html" tabindex="-1" aria-hidden="true" style="width: 1px; height: 1px; position: absolute; top: -100px;"></iframe></body></html>